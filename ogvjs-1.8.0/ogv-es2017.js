!function webpackUniversalModuleDefinition(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ogvjs=t():e.ogvjs=t()}(window,(function(){return function(e){var t={};function __webpack_require__(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,i){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)__webpack_require__.d(i,r,function(t){return e[t]}.bind(null,r));return i},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=11)}([function(e,t){e.exports=function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}},function(e,t,i){"use strict";var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i(14)),s=r(i(15)),n=r(i(16));const a={audio:{proxy:o.default,worker:"ogv-worker-audio.js"},video:{proxy:s.default,worker:"ogv-worker-video.js"}},d={OGVDecoderAudioOpusW:"audio",OGVDecoderAudioVorbisW:"audio",OGVDecoderVideoTheoraW:"video",OGVDecoderVideoVP8W:"video",OGVDecoderVideoVP9W:"video",OGVDecoderVideoVP9SIMDW:"video",OGVDecoderVideoAV1W:"video",OGVDecoderVideoAV1SIMDW:"video"};class OGVLoaderWeb extends n.default{constructor(){super(),this.scriptStatus={},this.scriptCallbacks={}}getGlobal(){return window}defaultBase(){let e,t,i=document.querySelectorAll("script"),r=/^(?:|(.*)\/)ogv(?:-support|-es2017)?\.js(?:\?|#|$)/;for(let o=0;o<i.length;o++)if(e=i[o].getAttribute("src"),e&&(t=e.match(r),t))return t[1]}loadClass(e,t,i){(i=i||{}).worker?this.workerProxy(e,t):super.loadClass(e,t,i)}loadScript(e,t){if("done"==this.scriptStatus[e])t();else if("loading"==this.scriptStatus[e])this.scriptCallbacks[e].push(t);else{this.scriptStatus[e]="loading",this.scriptCallbacks[e]=[t];let i=document.createElement("script"),done=t=>{let i=this.scriptCallbacks[e];delete this.scriptCallbacks[e],this.scriptStatus[e]="done",i.forEach(e=>{e()})};i.addEventListener("load",done),i.addEventListener("error",done),i.src=e,document.querySelector("head").appendChild(i)}}workerProxy(e,t){let i=d[e],r=a[i];if(!r)throw new Error("Requested worker for class with no proxy: "+e);let o,s=r.proxy,n=r.worker,u=this.urlForScript(this.scriptForClass(e)),h=this.urlForScript(n);var c=function construct(t){return new s(o,e,t)};if(h.match(/^https?:|\/\//i)){var l,f,_,p,m,g=!1,y=!1;function completionCheck(){if(1==g&&1==y){try{m=new Blob([_+" "+p],{type:"application/javascript"})}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(m=new BlobBuilder).append(_+" "+p),m=m.getBlob()}o=new Worker(URL.createObjectURL(m)),t((function(e){return Promise.resolve(new c(e))}))}}(l=new XMLHttpRequest).open("GET",u,!0),l.onreadystatechange=function(){4==l.readyState&&200==l.status&&(_=l.responseText,g=!0,completionCheck())},l.send(),(f=new XMLHttpRequest).open("GET",h,!0),f.onreadystatechange=function(){4==f.readyState&&200==f.status&&(p=f.responseText,y=!0,completionCheck())},f.send()}else o=new Worker(h),t((function(e){return Promise.resolve(new c(e))}))}}var u=new OGVLoaderWeb;t.default=u},function(e,t){!function(){"use strict";function FrameSink(e,t){throw new Error("abstract")}FrameSink.prototype.drawFrame=function(e){throw new Error("abstract")},FrameSink.prototype.clear=function(){throw new Error("abstract")},e.exports=FrameSink}()},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var o=function(e){function DownloadBackend(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DownloadBackend),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(DownloadBackend.__proto__||Object.getPrototypeOf(DownloadBackend)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(DownloadBackend,e),r(DownloadBackend,[{key:"bufferToOffset",value:function bufferToOffset(e){var t=this;return new Promise((function(i,r){if(t.eof||t.offset>=e)i();else{var o=null;t._onAbort=function(e){o(),r(e)};var s=function checkBuffer(){t.offset>=e&&!t.eof&&(o(),i())},n=function checkDone(){o(),i()},a=function checkError(){o(),r(new Error("error streaming"))};o=function oncomplete(){t.buffering=!1,t.off("buffer",s),t.off("done",n),t.off("error",a),t._onAbort=null},t.buffering=!0,t.on("buffer",s),t.on("done",n),t.on("error",a)}}))}},{key:"initXHR",value:function initXHR(){(function get(e,t,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,i)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(i):void 0})(DownloadBackend.prototype.__proto__||Object.getPrototypeOf(DownloadBackend.prototype),"initXHR",this).call(this)}},{key:"onXHRStart",value:function onXHRStart(){var e=this;this.xhr.addEventListener("progress",(function(){return e.onXHRProgress()})),this.xhr.addEventListener("error",(function(){return e.onXHRError()})),this.xhr.addEventListener("load",(function(){return e.onXHRLoad()})),this.emit("open")}},{key:"onXHRProgress",value:function onXHRProgress(){throw new Error("abstract")}},{key:"onXHRError",value:function onXHRError(){this.emit("error")}},{key:"onXHRLoad",value:function onXHRLoad(){this.eof=!0,this.emit("done")}}]),DownloadBackend}(i(34));e.exports=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=
/**
 * Proxy object for web worker interface for codec classes.
 *
 * Used by the high-level player interface.
 *
 * @author Brion Vibber <brion@pobox.com>
 * @copyright 2015-2019 Brion Vibber
 * @license MIT-style
 */
function OGVProxyClass(e){return class{constructor(t,i,r){r=r||{},this.worker=t,this.transferables=function(){let e=new ArrayBuffer(1024),i=new Uint8Array(e);try{return t.postMessage({action:"transferTest",bytes:i},[e]),!e.byteLength}catch(e){return!1}}();for(let t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.processingQueue=0,Object.defineProperty(this,"processing",{get:function get(){return this.processingQueue>0}}),this.messageCount=0,this.pendingCallbacks={},this.worker.addEventListener("message",e=>{this.handleMessage(e)}),this.proxy("construct",[i,r],()=>{})}proxy(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!this.worker)throw'Tried to call "'+e+'" method on closed proxy object';let o="callback-"+ ++this.messageCount+"-"+e;i&&(this.pendingCallbacks[o]=i);let s={action:e,callbackId:o,args:t||[]};this.processingQueue++,this.transferables?this.worker.postMessage(s,r):this.worker.postMessage(s)}terminate(){this.worker&&(this.worker.terminate(),this.worker=null,this.processingQueue=0,this.pendingCallbacks={})}handleMessage(e){if(this.processingQueue--,"callback"!==e.data.action)return;let t=e.data,i=t.callbackId,r=t.args,o=this.pendingCallbacks[i];if(t.props)for(let e in t.props)t.props.hasOwnProperty(e)&&(this[e]=t.props[e]);o&&(delete this.pendingCallbacks[i],o.apply(this,r))}}};t.default=r},function(e,t,i){"use strict";var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i(6));const s={MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4};class OGVMediaError{constructor(e,t){this.code=e,this.message=t}}(0,o.default)(OGVMediaError,s),(0,o.default)(OGVMediaError.prototype,s);var n=OGVMediaError;t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function extend(e,t){for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};t.default=r},function(e,t,i){"use strict";function split(e,t,i){let r=e.split(t,i).map(e=>(function trim(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")})(e));if("number"==typeof i)for(;r.length<i;)r.push(null);return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=class OGVMediaType{constructor(e){e=String(e),this.major=null,this.minor=null,this.codecs=null;let t=split(e,";");if(t.length){let e=t.shift();if(e){let t=split(e,"/",2);this.major=t[0],this.minor=t[1]}for(let e in t){let i=t[e].match(/^codecs\s*=\s*"(.*?)"$/);if(i){this.codecs=split(i[1],",");break}}}}};t.default=r},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var o=function(){function TinyEvents(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,TinyEvents),this._e={}}return r(TinyEvents,[{key:"on",value:function on(e,t){(this._e[e]||(this._e[e]=[])).push(t)}},{key:"off",value:function off(e,t){var i=this._e[e]||[],r=i.indexOf(t);t>=0&&i.splice(r,1)}},{key:"emit",value:function emit(e,t){(this._e[e]||[]).slice().forEach((function(e){return e(t)}))}}]),TinyEvents}();e.exports=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=class OGVTimeRanges{constructor(e){this._ranges=e,this.length=e.length}start(e){if(e<0||e>this.length||e!==(0|e))throw new RangeError("Invalid index");return this._ranges[e][0]}end(e){if(e<0||e>this.length||e!==(0|e))throw new RangeError("Invalid index");return this._ranges[e][1]}};t.default=r},function(e,t,i){"use strict";var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"OGVCompat",{enumerable:!0,get:function get(){return o.default}}),Object.defineProperty(t,"OGVLoader",{enumerable:!0,get:function get(){return s.default}}),Object.defineProperty(t,"OGVMediaError",{enumerable:!0,get:function get(){return n.default}}),Object.defineProperty(t,"OGVMediaType",{enumerable:!0,get:function get(){return a.default}}),Object.defineProperty(t,"OGVPlayer",{enumerable:!0,get:function get(){return d.default}}),Object.defineProperty(t,"OGVTimeRanges",{enumerable:!0,get:function get(){return u.default}}),t.OGVVersion=void 0;var o=r(i(12)),s=r(i(1)),n=r(i(5)),a=r(i(7)),d=r(i(18)),u=r(i(10));t.OGVVersion="1.8.0-20210209191056-7b5e38a","object"==typeof window&&(window.OGVCompat=o.default,window.OGVLoader=s.default,window.OGVMediaError=n.default,window.OGVMediaType=a.default,window.OGVTimeRanges=u.default,window.OGVPlayer=d.default,window.OGVVersion="1.8.0-20210209191056-7b5e38a")},function(e,t,i){"use strict";var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i(13));var s=new class{constructor(){this.benchmark=new o.default}hasTypedArrays(){return!!window.Uint32Array}hasWebAudio(){return!(!window.AudioContext&&!window.webkitAudioContext)}hasFlash(){if(-1!==navigator.userAgent.indexOf("Trident"))try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return!0}catch(e){return!1}return!1}hasAudio(){return this.hasWebAudio()||this.hasFlash()}isBlacklisted(e){let t=!1;return[/\(i.* OS [6789]_.* like Mac OS X\).* Mobile\/.* Safari\//,/\(Macintosh.* Version\/6\..* Safari\/\d/].forEach(i=>{e.match(i)&&(t=!0)}),t}isSlow(){return this.benchmark.slow}isTooSlow(){return this.benchmark.tooSlow}supported(e){return"OGVDecoder"===e?this.hasTypedArrays()&&!this.isBlacklisted(navigator.userAgent):"OGVPlayer"===e&&(this.supported("OGVDecoder")&&this.hasAudio()&&!this.isTooSlow())}};t.default=s},function(e,t,i){"use strict";e.exports=function BogoSlow(){var e,t=this;e=window.performance&&window.performance.now?function timer(){return window.performance.now()}:function timer(){return Date.now()};var i=null;Object.defineProperty(t,"speed",{get:function get(){return null===i&&function run(){var t=0,r=e();!function fibonacci(e){return t++,e<2?e:fibonacci(e-2)+fibonacci(e-1)}(30);var o=e()-r;i=t/o}(),i}}),Object.defineProperty(t,"slowCutoff",{get:function get(){return 5e4}}),Object.defineProperty(t,"tooSlowCutoff",{get:function get(){return 0}}),Object.defineProperty(t,"slow",{get:function get(){return t.speed<t.slowCutoff}}),Object.defineProperty(t,"tooSlow",{get:function get(){return t.speed<t.tooSlowCutoff}})}},function(e,t,i){"use strict";var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i(4));class OGVDecoderAudioProxy extends((0,o.default)({loadedMetadata:!1,audioFormat:null,audioBuffer:null,cpuTime:0})){init(e){this.proxy("init",[],e)}processHeader(e,t){this.proxy("processHeader",[e],t,[e])}processAudio(e,t){this.proxy("processAudio",[e],t,[e])}close(){this.terminate()}}var s=OGVDecoderAudioProxy;t.default=s},function(e,t,i){"use strict";var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i(4));class OGVDecoderVideoProxy extends((0,o.default)({loadedMetadata:!1,videoFormat:null,frameBuffer:null,cpuTime:0})){init(e){this.proxy("init",[],e)}processHeader(e,t){this.proxy("processHeader",[e],t,[e])}processFrame(e,t){this.proxy("processFrame",[e],t,[e])}close(){this.terminate()}sync(){this.proxy("sync",[],()=>{})}recycleFrame(e){this.proxy("recycleFrame",[e],()=>{},[e.y.bytes.buffer,e.u.bytes.buffer,e.v.bytes.buffer])}}var s=OGVDecoderVideoProxy;t.default=s},function(e,t,i){"use strict";var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i(17));const s="1.8.0-20210209191056-7b5e38a",n={OGVDemuxerOggW:"ogv-demuxer-ogg-wasm.js",OGVDemuxerWebMW:"ogv-demuxer-webm-wasm.js",OGVDecoderAudioOpusW:"ogv-decoder-audio-opus-wasm.js",OGVDecoderAudioVorbisW:"ogv-decoder-audio-vorbis-wasm.js",OGVDecoderVideoTheoraW:"ogv-decoder-video-theora-wasm.js",OGVDecoderVideoVP8W:"ogv-decoder-video-vp8-wasm.js",OGVDecoderVideoVP8MTW:"ogv-decoder-video-vp8-mt-wasm.js",OGVDecoderVideoVP9W:"ogv-decoder-video-vp9-wasm.js",OGVDecoderVideoVP9SIMDW:"ogv-decoder-video-vp9-simd-wasm.js",OGVDecoderVideoVP9MTW:"ogv-decoder-video-vp9-mt-wasm.js",OGVDecoderVideoVP9SIMDMTW:"ogv-decoder-video-vp9-simd-mt-wasm.js",OGVDecoderVideoAV1W:"ogv-decoder-video-av1-wasm.js",OGVDecoderVideoAV1SIMDW:"ogv-decoder-video-av1-simd-wasm.js",OGVDecoderVideoAV1MTW:"ogv-decoder-video-av1-mt-wasm.js",OGVDecoderVideoAV1SIMDMTW:"ogv-decoder-video-av1-simd-mt-wasm.js"};var a=class OGVLoaderBase{constructor(){this.base=this.defaultBase()}defaultBase(){}wasmSupported(){return o.default.wasmSupported()}scriptForClass(e){return n[e]}urlForClass(e){let t=this.scriptForClass(e);if(t)return this.urlForScript(t);throw new Error("asked for URL for unknown class "+e)}urlForScript(e){if(e){let t=this.base;return void 0===t?t="":t+="/",t+e+"?version="+encodeURIComponent(s)}throw new Error("asked for URL for unknown script "+e)}loadClass(e,t,i){i=i||{};let r=this.getGlobal(),o=this.urlForClass(e),classWrapper=t=>((t=t||{}).locateFile=e=>"data:"===e.slice(0,5)?e:this.urlForScript(e),t.mainScriptUrlOrBlob=this.scriptForClass(e)+"?version="+encodeURIComponent(s),r[e](t));"function"==typeof r[e]?t(classWrapper):this.loadScript(o,()=>{t(classWrapper)})}};t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=new class WebAssemblyChecker{constructor(){this.tested=!1,this.testResult=void 0}wasmSupported(){if(!this.tested){try{"object"==typeof WebAssembly?this.testResult=function testSafariWebAssemblyBug(){let e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)}():this.testResult=!1}catch(e){console.log("Exception while testing WebAssembly",e),this.testResult=!1}this.tested=!0}return this.testResult}};t.default=r},function(e,t,i){"use strict";(function(e){var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i(22)),s=r(i(28)),a=r(i(37)),d=r(i(1)),u=r(i(38)),h=r(i(6)),c=r(i(5)),l=r(i(7)),f=r(i(10)),_=r(i(39));const p={NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3,HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},m={INITIAL:"INITIAL",SEEKING_END:"SEEKING_END",LOADED:"LOADED",PRELOAD:"PRELOAD",READY:"READY",PLAYING:"PLAYING",SEEKING:"SEEKING",ENDED:"ENDED",ERROR:"ERROR"},g={NOT_SEEKING:"NOT_SEEKING",BISECT_TO_TARGET:"BISECT_TO_TARGET",BISECT_TO_KEYPOINT:"BISECT_TO_KEYPOINT",LINEAR_TO_TARGET:"LINEAR_TO_TARGET"},y={EXACT:"exact",FAST:"fast"};let v;function OGVJSElement(){let e=document.createElement("ogvjs");return Object.setPrototypeOf?Object.setPrototypeOf(e,Object.getPrototypeOf(this)):e.__proto__=this.__proto__,e}v="undefined"==typeof performance||void 0===typeof performance.now?Date.now:performance.now.bind(performance),OGVJSElement.prototype=Object.create(HTMLElement.prototype,{});class OGVPlayer extends OGVJSElement{constructor(e){if(super(),(e=e||{}).base=e.base||d.default.base,this._options=e,this._instanceId="ogvjs"+ ++OGVPlayer.instanceCount,void 0!==e.worker?this._enableWorker=!!e.worker:this._enableWorker=!!window.Worker,!d.default.wasmSupported())throw new Error("WebAssembly not supported");this._enableThreading=!!e.threading,this._enableSIMD=!!e.simd,this._state=m.INITIAL,this._seekState=g.NOT_SEEKING,this._detectedType=null,this._canvas=document.createElement("canvas"),this._frameSink=null,e.video&&this._canvas.captureStream?(this._mediaStream=new MediaStream,this._video="object"==typeof e.video?e.video:document.createElement("video"),this._video.playsInline=!0,this._video.srcObject=this._mediaStream):this._video=null,this._videoTrack=null,this._audioTrack=null,this._canvasStream=null,this.className=this._instanceId,(0,h.default)(this,p),this._view=this._video||this._canvas,this._view.style.position="absolute",this._view.style.top="0",this._view.style.left="0",this._view.style.width="100%",this._view.style.height="100%",this._view.style.objectFit="contain",this.appendChild(this._view),this._startTime=v(),this._codec=null,this._audioInfo=null,this._videoInfo=null,this._actionQueue=[],this._audioFeeder=null,this._muted=!1,this._initialPlaybackPosition=0,this._initialPlaybackOffset=0,this._prebufferingAudio=!1,this._initialSeekTime=0,this._currentSrc="",this._streamEnded=!1,this._mediaError=null,this._dataEnded=!1,this._byteLength=0,this._duration=null,this._lastSeenTimestamp=null,this._nextProcessingTimer,this._nextFrameTimer=null,this._loading=!1,this._started=!1,this._paused=!0,this._ended=!1,this._startedPlaybackInDocument=!1,this._stream=void 0,this._framesProcessed=0,this._targetPerFrameTime=1e3/60,this._actualPerFrameTime=0,this._totalFrameTime=0,this._totalFrameCount=0,this._playTime=0,this._bufferTime=0,this._drawingTime=0,this._proxyTime=0,this._totalJitter=0,this._droppedAudio=0,this._delayedAudio=0,this._lateFrames=0,this._poster="",this._thumbnail=null,this._frameEndTimestamp=0,this._audioEndTimestamp=0,this._decodedFrames=[],this._pendingFrames=[],this._lastFrameDecodeTime=0,this._lastFrameVideoCpuTime=0,this._lastFrameAudioCpuTime=0,this._lastFrameDemuxerCpuTime=0,this._lastFrameDrawingTime=0,this._lastFrameBufferTime=0,this._lastFrameProxyTime=0,this._lastVideoCpuTime=0,this._lastAudioCpuTime=0,this._lastDemuxerCpuTime=0,this._lastBufferTime=0,this._lastProxyTime=0,this._lastDrawingTime=0,this._lastFrameTimestamp=0,this._currentVideoCpuTime=0,this._lastTimeUpdate=0,this._timeUpdateInterval=250,this._seekTargetTime=0,this._bisectTargetTime=0,this._seekMode=null,this._lastSeekPosition=null,this._seekBisector=null,this._didSeek=null,this._depth=0,this._needProcessing=!1,this._pendingFrame=0,this._pendingAudio=0,this._framePipelineDepth=8,this._frameParallelism=this._enableThreading?Math.min(16,navigator.hardwareConcurrency)||1:0,this._audioPipelineDepth=12,this._videoInfo=null,this._audioInfo=null,this._width=0,this._height=0,this._volume=1,this._playbackRate=1,Object.defineProperties(this,{src:{get:function getSrc(){return this.getAttribute("src")||""},set:function setSrc(e){this.setAttribute("src",e),this._loading=!1,this._prepForLoad("interactive")}},buffered:{get:function getBuffered(){let e;return e=this._stream&&this._byteLength&&this._duration?this._stream.getBufferedRanges().map(e=>e.map(e=>e/this._stream.length*this._duration)):[[0,0]],new f.default(e)}},seekable:{get:function getSeekable(){return this.duration<1/0&&this._stream&&this._stream.seekable&&this._codec&&this._codec.seekable?new f.default([[0,this._duration]]):new f.default([])}},currentTime:{get:function getCurrentTime(){return this._state==m.SEEKING?this._seekTargetTime:this._codec?this._state!=m.PLAYING||this._paused?this._initialPlaybackOffset:this._getPlaybackTime():this._initialSeekTime},set:function setCurrentTime(e){this._seek(e,y.EXACT)}},duration:{get:function getDuration(){return this._codec&&this._codec.loadedMetadata?null!==this._duration?this._duration:1/0:NaN}},paused:{get:function getPaused(){return this._paused}},ended:{get:function getEnded(){return this._ended}},seeking:{get:function getSeeking(){return this._state==m.SEEKING}},muted:{get:function getMuted(){return this._muted},set:function setMuted(e){this._muted=e,this._audioFeeder?this._audioFeeder.muted=this._muted:this._started&&!this._muted&&this._codec&&this._codec.hasAudio&&(this._log("unmuting: switching from timer to audio clock"),this._initAudioFeeder(),this._startPlayback(this._audioEndTimestamp)),this._fireEventAsync("volumechange")}},poster:{get:function getPoster(){return this._poster},set:function setPoster(e){if(this._poster=e,!this._started){this._thumbnail&&this.removeChild(this._thumbnail);let e=new Image;e.src=this._poster,e.className="ogvjs-poster",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.objectFit="contain",e.style.visibility="hidden",e.addEventListener("load",()=>{this._thumbnail===e&&(OGVPlayer.styleManager.appendRule("."+this._instanceId,{width:e.naturalWidth+"px",height:e.naturalHeight+"px"}),OGVPlayer.updatePositionOnResize(),e.style.visibility="visible")}),this._thumbnail=e,this.appendChild(e)}}},videoWidth:{get:function getVideoWidth(){return this._videoInfo?this._videoInfo.displayWidth:0}},videoHeight:{get:function getVideoHeight(){return this._videoInfo?this._videoInfo.displayHeight:0}},ogvjsVideoFrameRate:{get:function getOgvJsVideoFrameRate(){return this._videoInfo?0==this._videoInfo.fps?this._totalFrameCount/(this._totalFrameTime/1e3):this._videoInfo.fps:0}},ogvjsAudioChannels:{get:function getOgvJsAudioChannels(){return this._audioInfo?this._audioInfo.channels:0}},ogvjsAudioSampleRate:{get:function getOgvJsAudioChannels(){return this._audioInfo?this._audioInfo.rate:0}},width:{get:function getWidth(){return this._width},set:function setWidth(e){this._width=parseInt(e,10),this.style.width=this._width+"px",OGVPlayer.updatePositionOnResize()}},height:{get:function getHeight(){return this._height},set:function setHeight(e){this._height=parseInt(e,10),this.style.height=this._height+"px",OGVPlayer.updatePositionOnResize()}},autoplay:{get:function getAutoplay(){return!1},set:function setAutoplay(e){}},controls:{get:function getControls(){return!1},set:function setControls(e){}},loop:{get:function getLoop(){return!1},set:function setLoop(e){}},crossOrigin:{get:function getCrossOrigin(){return null},set:function setCrossOrigin(e){}},currentSrc:{get:function getCurrentSrc(){return this._currentSrc}},defaultMuted:{get:function getDefaultMuted(){return!1}},defaultPlaybackRate:{get:function getDefaultPlaybackRate(){return 1}},error:{get:function getError(){return this._state===m.ERROR?this._mediaError?this._mediaError:new c.default("unknown error occurred in media procesing"):null}},preload:{get:function getPreload(){return this.getAttribute("preload")||""},set:function setPreload(e){this.setAttribute("preload",e)}},readyState:{get:function getReadyState(){return this._stream&&this._codec&&this._codec.loadedMetadata?OGVPlayer.HAVE_ENOUGH_DATA:OGVPlayer.HAVE_NOTHING}},networkState:{get:function getNetworkState(){return this._stream?this._stream.waiting?OGVPlayer.NETWORK_LOADING:OGVPlayer.NETWORK_IDLE:this.readyState==OGVPlayer.HAVE_NOTHING?OGVPlayer.NETWORK_EMPTY:OGVPlayer.NETWORK_NO_SOURCE}},playbackRate:{get:function getPlaybackRate(){return this._playbackRate},set:function setPlaybackRate(e){var t=Number(e)||1;this._audioFeeder?this._audioFeeder.tempo=t:this._paused||(this._initialPlaybackOffset=this._getPlaybackTime(),this._initialPlaybackPosition=t*v()/1e3),this._playbackRate=t,this._fireEventAsync("ratechange")}},played:{get:function getPlayed(){return new f.default([[0,this.currentTime]])}},volume:{get:function getVolume(){return this._volume},set:function setVolume(e){this._volume=+e,this._audioFeeder&&(this._audioFeeder.volume=this._volume),this._fireEventAsync("volumechange")}}}),this.onframecallback=null,this.onloadstate=null,this.onprogress=null,this.onsuspend=null,this.onabort=null,this.onemptied=null,this.onstalled=null,this.onloadedmetadata=null,this.onloadeddata=null,this.oncanplay=null,this.oncanplaythrough=null,this.onplaying=null,this.onwaiting=null,this.onseeking=null,this.onseeked=null,this.onended=null,this.ondurationchange=null,this.ontimeupdate=null,this.onplay=null,this.onpause=null,this.onratechange=null,this.onresize=null,this.onvolumechange=null,this.onaudiofeedercreated=null}_time(e){let t=v();e();let i=v()-t;return this._lastFrameDecodeTime+=i,i}_log(e){let t=this._options;if(t.debug){let i=v()-this._startTime;t.debugFilter&&!e.match(t.debugFilter)||console.log("["+Math.round(10*i)/10+"ms] "+e)}}_fireEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._log("fireEvent "+e);let i,r="function"==typeof Event;r?i=new CustomEvent(e):(i=document.createEvent("Event"),i.initEvent(e,!1,!1));for(let e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);let o=this.dispatchEvent(i);!r&&"resize"===e&&this.onresize&&o&&this.onresize.call(this,i)}_fireEventAsync(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._log("fireEventAsync "+t),e(()=>{this._fireEvent(t,i)})}static initSharedAudioContext(){a.default.initSharedAudioContext()}_initAudioFeeder(){let e=this._options,t={bufferSize:8192};if(e.audioContext&&(t.audioContext=e.audioContext),e.audioDestination&&(t.output=e.audioDestination),e.audioBackendFactory&&(t.backendFactory=e.audioBackendFactory),this._video&&!t.output){t.audioContext||(t.audioContext=a.default.initSharedAudioContext());let e=t.audioContext.createMediaStreamDestination();this._audioTrack=e.stream.getAudioTracks()[0],this._mediaStream.addTrack(this._audioTrack),navigator.userAgent.match(/WebKit/)&&(this._video.src=this._mediaStream),this._video.play(),t.output=e}let i=this._audioFeeder=new a.default(t);i.init(this._audioInfo.channels,this._audioInfo.rate),this.onaudiofeedercreated&&this.onaudiofeedercreated(this._audioFeeder),i.bufferThreshold=1,i.volume=this.volume,i.muted=this.muted,i.tempo=this.playbackRate,i.onbufferlow=()=>{this._log("onbufferlow"),this._stream&&(this._stream.buffering||this._stream.seeking)||this._pendingAudio||this._pingProcessing()},i.onstarved=()=>{this._dataEnded?this._log("onstarved: appear to have reached end of audio"):(this._log("onstarved: halting audio due to starvation"),this._stopPlayback(),this._prebufferingAudio=!0),this._isProcessing()||this._pingProcessing(0)}}_startPlayback(e){if(this._audioFeeder){this._audioFeeder.start();let e=this._audioFeeder.getPlaybackState();this._initialPlaybackPosition=e.playbackPosition}else this._initialPlaybackPosition=this._playbackRate*v()/1e3;void 0!==e&&(this._initialPlaybackOffset=e),this._prebufferingAudio=!1,this._log("continuing at "+this._initialPlaybackPosition+", "+this._initialPlaybackOffset)}_stopPlayback(){this._initialPlaybackOffset=this._getPlaybackTime(),this._log("pausing at "+this._initialPlaybackOffset),this._audioFeeder&&this._audioFeeder.stop()}_getPlaybackTime(e){if(this._prebufferingAudio||this._paused)return this._initialPlaybackOffset;{let t;return t=this._audioFeeder?(e=e||this._audioFeeder.getPlaybackState()).playbackPosition:this._playbackRate*v()/1e3,t-this._initialPlaybackPosition+this._initialPlaybackOffset}}_stopVideo(){this._log("STOPPING"),this._state=m.INITIAL,this._seekState=g.NOT_SEEKING,this._started=!1,this._ended=!1,this._frameEndTimestamp=0,this._audioEndTimestamp=0,this._lastFrameDecodeTime=0,this._prebufferingAudio=!1,this._actionQueue.splice(0,this._actionQueue.length),this._stream&&(this._stream.abort(),this._stream=null,this._streamEnded=!1),this._codec&&(this._codec.close(),this._codec=null,this._pendingFrame=0,this._pendingAudio=0,this._dataEnded=!1),this._videoInfo=null,this._audioInfo=null,this._audioFeeder&&(this._audioFeeder.close(),this._audioFeeder=null),this._nextProcessingTimer&&(clearTimeout(this._nextProcessingTimer),this._nextProcessingTimer=null),this._nextFrameTimer&&(clearTimeout(this._nextFrameTimer),this._nextFrameTimer=null),this._frameSink&&(this._frameSink.clear(),this._frameSink=null),this._decodedFrames&&(this._decodedFrames=[]),this._pendingFrames&&(this._pendingFrames=[]),this._initialSeekTime=0,this._initialPlaybackPosition=0,this._initialPlaybackOffset=0,this._duration=null}_doFrameComplete(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._startedPlaybackInDocument&&!document.body.contains(this)&&e(()=>{this.stop()});let i=v(),r=i-this._lastFrameTimestamp,o=this._actualPerFrameTime-this._targetPerFrameTime;this._totalJitter+=Math.abs(o),this._playTime+=r;let s={cpuTime:this._lastFrameDecodeTime,drawingTime:this._drawingTime-this._lastFrameDrawingTime,bufferTime:this._bufferTime-this._lastFrameBufferTime,proxyTime:this._proxyTime-this._lastFrameProxyTime,demuxerTime:0,videoTime:0,audioTime:0,clockTime:this._actualPerFrameTime,late:t.dropped,dropped:t.dropped};function n(e){return Math.round(10*e)/10}this._codec&&(s.demuxerTime=this._codec.demuxerCpuTime-this._lastFrameDemuxerCpuTime,s.videoTime+=this._currentVideoCpuTime-this._lastFrameVideoCpuTime,s.audioTime+=this._codec.audioCpuTime-this._lastFrameAudioCpuTime),s.cpuTime+=s.demuxerTime,this._lastFrameDecodeTime=0,this._lastFrameTimestamp=i,this._codec?(this._lastFrameVideoCpuTime=this._currentVideoCpuTime,this._lastFrameAudioCpuTime=this._codec.audioCpuTime,this._lastFrameDemuxerCpuTime=this._codec.demuxerCpuTime):(this._lastFrameVideoCpuTime=0,this._lastFrameAudioCpuTime=0,this._lastFrameDemuxerCpuTime=0),this._lastFrameDrawingTime=this._drawingTime,this._lastFrameBufferTime=this._bufferTime,this._lastFrameProxyTime=this._proxyTime,this._log("drew frame "+t.frameEndTimestamp+": clock time "+n(r)+" (jitter "+n(o)+") cpu: "+n(s.cpuTime)+" (mux: "+n(s.demuxerTime)+" buf: "+n(s.bufferTime)+" draw: "+n(s.drawingTime)+" proxy: "+n(s.proxyTime)+") vid: "+n(s.videoTime)+" aud: "+n(s.audioTime)),this._fireEventAsync("framecallback",s),(!this._lastTimeUpdate||i-this._lastTimeUpdate>=this._timeUpdateInterval)&&(this._lastTimeUpdate=i,this._fireEventAsync("timeupdate")),this._codec&&t.yCbCrBuffer&&this._codec.recycleFrame(t.yCbCrBuffer)}_seekStream(e){this._stream.seeking&&this._stream.abort(),this._stream.buffering&&this._stream.abort(),this._streamEnded=!1,this._dataEnded=!1,this._ended=!1,this._stream.seek(e).then(()=>{this._readBytesAndWait()}).catch(e=>{this._onStreamError(e)})}_onStreamError(e){"AbortError"===e.name?this._log("i/o promise canceled; ignoring"):(this._log("i/o error: "+e),this._mediaError=new c.default(c.default.MEDIA_ERR_NETWORK,String(e)),this._state=m.ERROR,this._stopPlayback())}_seek(e,t){if(this._log("requested seek to "+e+", mode "+t),this.readyState==this.HAVE_NOTHING)return this._log("not yet loaded; saving seek position for later"),void(this._initialSeekTime=e);if(this._stream&&!this._stream.seekable)throw new Error("Cannot seek a non-seekable stream");if(this._codec&&!this._codec.seekable)throw new Error("Cannot seek in a non-seekable file");let prepForSeek=i=>{this._stream&&this._stream.buffering&&this._stream.abort(),this._stream&&this._stream.seeking&&this._stream.abort(),this._actionQueue.splice(0,this._actionQueue.length),this._stopPlayback(),this._prebufferingAudio=!1,this._audioFeeder&&this._audioFeeder.flush(),this._state=m.SEEKING,this._seekTargetTime=e,this._seekMode=t,this._codec?this._codec.flush(i):i()};prepForSeek(()=>{this._isProcessing()||this._pingProcessing(0)}),this._actionQueue.push(()=>{prepForSeek(()=>{this._doSeek(e)})})}_doSeek(e){this._streamEnded=!1,this._dataEnded=!1,this._ended=!1,this._state=m.SEEKING,this._seekTargetTime=e,this._lastSeekPosition=-1,this._decodedFrames=[],this._pendingFrames=[],this._pendingFrame=0,this._pendingAudio=0,this._didSeek=!1,this._codec.seekToKeypoint(e,t=>{if(t)return this._seekState=g.LINEAR_TO_TARGET,this._fireEventAsync("seeking"),this._didSeek?void 0:void this._pingProcessing();this._codec.getKeypointOffset(e,e=>{e>0?(this._seekState=g.LINEAR_TO_TARGET,this._seekStream(e)):(this._seekState=g.BISECT_TO_TARGET,this._startBisection(this._seekTargetTime)),this._fireEventAsync("seeking")})})}_startBisection(e){let t=Math.max(0,this._stream.length-65536);this._bisectTargetTime=e,this._seekBisector=new u.default({start:0,end:t,process:(e,t,i)=>i!=this._lastSeekPosition&&(this._lastSeekPosition=i,this._codec.flush(()=>{this._seekStream(i)}),!0)}),this._seekBisector.start()}_continueSeekedPlayback(){this._seekState=g.NOT_SEEKING,this._state=m.READY,this._frameEndTimestamp=this._codec.frameTimestamp,this._audioEndTimestamp=this._codec.audioTimestamp,this._codec.hasAudio?this._seekTargetTime=this._codec.audioTimestamp:this._seekTargetTime=this._codec.frameTimestamp,this._initialPlaybackOffset=this._seekTargetTime;let finishedSeeking=()=>{this._lastTimeUpdate=this._seekTargetTime,this._fireEventAsync("timeupdate"),this._fireEventAsync("seeked"),this._isProcessing()||this._pingProcessing()};if(this._codec.hasVideo&&this._decodedFrames.length){let e=this._decodedFrames.shift();this._drawFrame(e.yCbCrBuffer),finishedSeeking()}else{if(this._codec.hasVideo&&this._codec.frameReady)return this._codec.decodeFrame(e=>{e&&this._drawFrame(this._codec.frameBuffer),finishedSeeking()}),void this._codec.sync();finishedSeeking()}}_drawFrame(e){this._thumbnail&&(this.removeChild(this._thumbnail),this._thumbnail=null),this._frameSink.drawFrame(e),this._video&&(this._canvasStream||(this._canvasStream=this._canvas.captureStream(0),this._videoTrack=this._canvasStream.getVideoTracks()[0],this._mediaStream.addTrack(this._videoTrack),navigator.userAgent.match(/WebKit/)&&(this._video.src=this._mediaStream,this._video.play())),this._videoTrack&&this._videoTrack.requestFrame?this._videoTrack.requestFrame():this._canvasStream&&this._canvasStream.requestFrame&&this._canvasStream.requestFrame())}_doProcessLinearSeeking(){let e;if(e=this._codec.hasVideo?this._targetPerFrameTime/1e3:1/256,this._codec.hasVideo){if(this._pendingFrame)return;if(!this._codec.frameReady)return void this._codec.process(e=>{e?this._pingProcessing():this._streamEnded?(this._log("stream ended during linear seeking on video"),this._dataEnded=!0,this._continueSeekedPlayback()):this._readBytesAndWait()});if(this._seekMode===y.FAST&&this._codec.keyframeTimestamp==this._codec.frameTimestamp)return void this._continueSeekedPlayback();if(this._codec.frameTimestamp<=this._seekTargetTime){let e=this._codec.frameTimestamp;return this._pendingFrame++,this._pendingFrames.push({frameEndTimestamp:e}),this._decodedFrames.splice(0,this._decodedFrames.length),this._codec.decodeFrame(t=>{this._pendingFrame--,this._pendingFrames.shift(),this._decodedFrames.push({yCbCrBuffer:this._codec.frameBuffer,videoCpuTime:this._codec.videoCpuTime,frameEndTimestamp:e}),this._pingProcessing()}),void this._codec.sync()}if(!this._codec.hasAudio)return void this._continueSeekedPlayback()}if(this._codec.hasAudio){if(this._pendingAudio)return;return this._codec.audioReady?this._codec.audioTimestamp+e<this._seekTargetTime?void this._codec.decodeAudio(()=>{this._pingProcessing()}):void this._continueSeekedPlayback():void this._codec.process(e=>{e?this._pingProcessing():this._streamEnded?(this._log("stream ended during linear seeking on audio"),this._dataEnded=!0,this._continueSeekedPlayback()):this._readBytesAndWait()})}}_doProcessBisectionSeek(){let e,t;if(this._codec.hasVideo)t=this._codec.frameTimestamp,e=this._targetPerFrameTime/1e3;else{if(!this._codec.hasAudio)throw new Error("Invalid seek state; no audio or video track available");t=this._codec.audioTimestamp,e=1/256}t<0?this._codec.process(e=>{if(e)this._pingProcessing();else if(this._streamEnded){if(this._log("stream ended during bisection seek"),!this._seekBisector.right())throw this._log("failed going back"),new Error("not sure what to do")}else this._readBytesAndWait()}):t-e/2>this._bisectTargetTime?this._seekBisector.left()||(this._log("close enough (left)"),this._seekTargetTime=t,this._continueSeekedPlayback()):t+e/2<this._bisectTargetTime?this._seekBisector.right()||(this._log("close enough (right)"),this._seekState=g.LINEAR_TO_TARGET,this._pingProcessing()):this._seekState==g.BISECT_TO_TARGET&&this._codec.hasVideo&&this._codec.keyframeTimestamp<this._codec.frameTimestamp?(this._log("finding the keypoint now"),this._seekState=g.BISECT_TO_KEYPOINT,this._startBisection(this._codec.keyframeTimestamp)):(this._log("straight seeking now"),this._seekState=g.LINEAR_TO_TARGET,this._pingProcessing())}_setupVideo(){this._videoInfo.fps>0?this._targetPerFrameTime=1e3/this._videoInfo.fps:this._targetPerFrameTime=16.667,this._canvas.width=this._videoInfo.displayWidth,this._canvas.height=this._videoInfo.displayHeight,OGVPlayer.styleManager.appendRule("."+this._instanceId,{width:this._videoInfo.displayWidth+"px",height:this._videoInfo.displayHeight+"px"}),OGVPlayer.updatePositionOnResize();let e={};void 0!==this._options.webGL&&(e.webGL=this._options.webGL),this._options.forceWebGL&&(e.webGL="required"),this._frameSink=o.default.attach(this._canvas,e)}_doProcessing(){if(this._didSeek&&(this._didSeek=!1),this._nextProcessingTimer=null,this._isProcessing(),this._depth>0)throw new Error("REENTRANCY FAIL: doProcessing recursing unexpectedly");let e=0;do{if(this._needProcessing=!1,this._depth++,this._doProcessingLoop(),this._depth--,this._needProcessing&&this._isProcessing())throw new Error("REENTRANCY FAIL: waiting on input or codec but asked to keep processing");++e>500&&(this._log("stuck in processing loop; breaking with timer"),this._needProcessing=0,this._pingProcessing(0))}while(this._needProcessing)}_doProcessingLoop(){if(this._actionQueue.length){this._actionQueue.shift()()}else if(this._state==m.INITIAL)this._doProcessInitial();else if(this._state==m.SEEKING_END)this._doProcessSeekingEnd();else if(this._state==m.LOADED)this._doProcessLoaded();else if(this._state==m.PRELOAD)this._doProcessPreload();else if(this._state==m.READY)this._doProcessReady();else if(this._state==m.SEEKING)this._doProcessSeeking();else if(this._state==m.PLAYING)this._doProcessPlay();else{if(this._state!=m.ERROR)throw new Error("Unexpected OGVPlayer state "+this._state);this._doProcessError()}}_doProcessInitial(){if(this._codec.loadedMetadata){if(!this._codec.hasVideo&&!this._codec.hasAudio)throw new Error("No audio or video found, something is wrong");this._codec.hasAudio&&(this._audioInfo=this._codec.audioFormat),this._codec.hasVideo&&(this._videoInfo=this._codec.videoFormat,this._setupVideo()),isNaN(this._codec.duration)||(this._duration=this._codec.duration),null===this._duration&&this._stream.seekable&&"video/ogg"==this._detectedType?(this._state=m.SEEKING_END,this._lastSeenTimestamp=-1,this._codec.flush(()=>{this._seekStream(Math.max(0,this._stream.length-131072))})):(this._state=m.LOADED,this._pingProcessing())}else this._codec.process(e=>{if(e)this._pingProcessing();else{if(this._streamEnded)throw new Error("end of file before headers found");this._log("reading more cause we are out of data"),this._readBytesAndWait()}})}_doProcessSeekingEnd(){this._codec.frameReady?(this._log("saw frame with "+this._codec.frameTimestamp),this._lastSeenTimestamp=Math.max(this._lastSeenTimestamp,this._codec.frameTimestamp),this._codec.discardFrame(()=>{this._pingProcessing()})):this._codec.audioReady?(this._log("saw audio with "+this._codec.audioTimestamp),this._lastSeenTimestamp=Math.max(this._lastSeenTimestamp,this._codec.audioTimestamp),this._codec.discardAudio(()=>{this._pingProcessing()})):this._codec.process(e=>{e?this._pingProcessing():this._stream.eof?(this._log("seek-duration: we are at the end: "+this._lastSeenTimestamp),this._lastSeenTimestamp>0&&(this._duration=this._lastSeenTimestamp),this._state=m.LOADED,this._codec.flush(()=>{this._streamEnded=!1,this._dataEnded=!1,this._seekStream(0)})):this._readBytesAndWait()})}_doProcessLoaded(){this._state=m.PRELOAD,this._fireEventAsync("loadedmetadata"),this._fireEventAsync("durationchange"),this._codec.hasVideo&&this._fireEventAsync("resize"),this._pingProcessing(0)}_doProcessPreload(){!this._codec.frameReady&&this._codec.hasVideo||!this._codec.audioReady&&this._codec.hasAudio?this._codec.process(e=>{e?this._pingProcessing():this._streamEnded?this._ended=!0:this._readBytesAndWait()}):(this._state=m.READY,this._fireEventAsync("loadeddata"),this._pingProcessing())}_doProcessReady(){if(this._log("initial seek to "+this._initialSeekTime),this._initialSeekTime>0){let e=this._initialSeekTime;this._initialSeekTime=0,this._log("initial seek to "+e),this._doSeek(e)}else if(this._paused)this._log("paused while in ready");else{let finishStartPlaying=()=>{this._log("finishStartPlaying"),this._state=m.PLAYING,this._lastFrameTimestamp=v(),this._codec.hasAudio&&this._audioFeeder?this._prebufferingAudio=!0:this._startPlayback(),this._pingProcessing(0),this._fireEventAsync("play"),this._fireEventAsync("playing")};!this._codec.hasAudio||this._audioFeeder||this._muted?finishStartPlaying():(this._initAudioFeeder(),this._audioFeeder.waitUntilReady(finishStartPlaying))}}_doProcessSeeking(){if(this._seekState==g.NOT_SEEKING)throw new Error("seeking in invalid state (not seeking?)");if(this._seekState==g.BISECT_TO_TARGET)this._doProcessBisectionSeek();else if(this._seekState==g.BISECT_TO_KEYPOINT)this._doProcessBisectionSeek();else{if(this._seekState!=g.LINEAR_TO_TARGET)throw new Error("Invalid seek state "+this._seekState);this._doProcessLinearSeeking()}}_doProcessPlay(){let e=this._codec;if(this._paused)this._log("paused during playback; stopping loop");else if((!e.hasAudio||e.audioReady||this._pendingAudio||this._dataEnded)&&(!e.hasVideo||e.frameReady||this._pendingFrame||this._decodedFrames.length||this._dataEnded)){var t,i,r,o=null,s=0,n=!1,a=0;if(e.hasAudio&&this._audioFeeder?(o=this._audioFeeder.getPlaybackState(),s=this._getPlaybackTime(o),n=this._dataEnded&&0==this._audioFeeder.durationBuffered,this._prebufferingAudio&&(this._audioFeeder.durationBuffered>=2*this._audioFeeder.bufferThreshold&&(!e.hasVideo||this._decodedFrames.length>=this._framePipelineDepth)||this._dataEnded)&&(this._log("prebuffering audio done; buffered to "+this._audioFeeder.durationBuffered),this._startPlayback(s),this._prebufferingAudio=!1),o.dropped!=this._droppedAudio&&this._log("dropped "+(o.dropped-this._droppedAudio)),o.delayed!=this._delayedAudio&&this._log("delayed "+(o.delayed-this._delayedAudio)),this._droppedAudio=o.dropped,this._delayedAudio=o.delayed,(t=this._audioFeeder.durationBuffered<=2*this._audioFeeder.bufferThreshold)&&(this._codec.audioReady?this._pendingAudio>=this._audioPipelineDepth&&(this._log("audio decode disabled: "+this._pendingAudio+" packets in flight"),t=!1):t=!1)):(s=this._getPlaybackTime(),t=this._codec.audioReady&&this._audioEndTimestamp<s),this._codec.hasVideo){i=this._decodedFrames.length>0,r=this._pendingFrame+this._decodedFrames.length<this._framePipelineDepth+this._frameParallelism&&this._codec.frameReady,i&&(a=1e3*(this._decodedFrames[0].frameEndTimestamp-s),this._actualPerFrameTime=this._targetPerFrameTime-a);let e=this._targetPerFrameTime;if(this._prebufferingAudio)r&&this._log("decoding a frame during prebuffering"),i=!1;else if(i&&this._dataEnded&&n)this._log("audio timeline ended? ready to draw frame");else if(i&&-a>=e){let e=-1;for(let t=0;t<this._decodedFrames.length-1;t++)this._decodedFrames[t].frameEndTimestamp<s&&(e=t-1);if(e>=0)for(;e-- >=0;){this._lateFrames++;let e=this._decodedFrames.shift();this._log("skipping already-decoded late frame at "+e.frameEndTimestamp),a=1e3*(e.frameEndTimestamp-s),this._frameEndTimestamp=e.frameEndTimestamp,this._actualPerFrameTime=this._targetPerFrameTime-a,this._framesProcessed++,e.dropped=!0,this._doFrameComplete(e)}let t=this._codec.nextKeyframeTimestamp,i=t-this._targetPerFrameTime/1e3*(this._framePipelineDepth+this._pendingFrame);if(t>=0&&t!=this._codec.frameTimestamp&&s>=i){this._log("skipping late frame at "+this._decodedFrames[0].frameEndTimestamp+" vs "+s+", expect to see keyframe at "+t);for(let e=0;e<this._decodedFrames.length;e++){let t=this._decodedFrames[e];this._lateFrames++,this._framesProcessed++,this._frameEndTimestamp=t.frameEndTimestamp,a=1e3*(t.frameEndTimestamp-s),this._actualPerFrameTime=this._targetPerFrameTime-a,t.dropped=!0,this._doFrameComplete(t)}this._decodedFrames=[];for(let e=0;e<this._pendingFrames.length;e++){let t=this._pendingFrames[e];this._lateFrames++,this._framesProcessed++,this._frameEndTimestamp=t.frameEndTimestamp,a=1e3*(t.frameEndTimestamp-s),this._actualPerFrameTime=this._targetPerFrameTime-a,t.dropped=!0,this._doFrameComplete(t)}for(this._pendingFrames=[],this._pendingFrame=0;this._codec.frameReady&&this._codec.frameTimestamp<t;){let e={frameEndTimestamp:this._codec.frameTimestamp,dropped:!0};a=1e3*(e.frameEndTimestamp-s),this._actualPerFrameTime=this._targetPerFrameTime-a,this._lateFrames++,this._codec.discardFrame(()=>{}),this._framesProcessed++,this._doFrameComplete(e)}return void(this._isProcessing()||this._pingProcessing())}}else i&&a<=4||(i=!1)}if(r){this._log("play loop: ready to decode frame; thread depth: "+this._pendingFrame+", have buffered: "+this._decodedFrames.length),0==this._videoInfo.fps&&this._codec.frameTimestamp-this._frameEndTimestamp>0&&(this._targetPerFrameTime=1e3*(this._codec.frameTimestamp-this._frameEndTimestamp)),this._totalFrameTime+=this._targetPerFrameTime,this._totalFrameCount++;let e=this._frameEndTimestamp=this._codec.frameTimestamp;this._pendingFrame++,this._pendingFrames.push({frameEndTimestamp:e});let t=this._pendingFrames,i=!1,r=this._time(()=>{this._codec.decodeFrame(r=>{t===this._pendingFrames?(this._log("play loop callback: decoded frame"),this._pendingFrame--,this._pendingFrames.shift(),r?this._decodedFrames.push({yCbCrBuffer:this._codec.frameBuffer,videoCpuTime:this._codec.videoCpuTime,frameEndTimestamp:e}):this._log("Bad video packet or something"),this._codec.process(()=>{this._isProcessing()||this._pingProcessing(i?void 0:0)})):this._log("play loop callback after flush, discarding")})});this._pendingFrame&&(i=!0,this._proxyTime+=r,this._pingProcessing(),this._dataEnded&&this._codec.sync())}else if(t){this._log("play loop: ready for audio; depth: "+this._pendingAudio),this._pendingAudio++;let e=this._codec.audioTimestamp,t=this._time(()=>{this._codec.decodeAudio(t=>{if(this._pendingAudio--,this._log("play loop callback: decoded audio"),this._audioEndTimestamp=e,t){let e=this._codec.audioBuffer;if(e&&(this._bufferTime+=this._time(()=>{this._audioFeeder&&this._audioFeeder.bufferData(e)}),!this._codec.hasVideo)){this._framesProcessed++;let e={frameEndTimestamp:this._audioEndTimestamp};this._doFrameComplete(e)}}this._isProcessing()||this._pingProcessing()})});this._pendingAudio&&(this._proxyTime+=t,this._codec.audioReady?this._pingProcessing():this._doProcessPlayDemux())}else if(i){this._log("play loop: ready to draw frame"),this._nextFrameTimer&&(clearTimeout(this._nextFrameTimer),this._nextFrameTimer=null),this._thumbnail&&(this.removeChild(this._thumbnail),this._thumbnail=null);let e=this._decodedFrames.shift();this._currentVideoCpuTime=e.videoCpuTime,this._drawingTime+=this._time(()=>{this._drawFrame(e.yCbCrBuffer)}),this._framesProcessed++,this._doFrameComplete(e),this._pingProcessing()}else if(!this._decodedFrames.length||this._nextFrameTimer||this._prebufferingAudio)if(this._dataEnded&&!(this._pendingAudio||this._pendingFrame||this._decodedFrames.length)){this._log("play loop: playback reached end of data "+[this._pendingAudio,this._pendingFrame,this._decodedFrames.length]);let e=0;this._codec.hasAudio&&this._audioFeeder&&(e=1e3*this._audioFeeder.durationBuffered),e>0?(this._log("play loop: ending pending "+e+" ms"),this._pingProcessing(Math.max(0,e))):(this._log("play loop: ENDING NOW: playback time "+this._getPlaybackTime()+"; frameEndTimestamp: "+this._frameEndTimestamp),this._stopPlayback(),this._prebufferingAudio=!1,this._initialPlaybackOffset=Math.max(this._audioEndTimestamp,this._frameEndTimestamp),this._ended=!0,this._paused=!0,this._fireEventAsync("pause"),this._fireEventAsync("ended"))}else this._prebufferingAudio&&(e.hasVideo&&!e.frameReady||e.hasAudio&&!e.audioReady)?(this._log("play loop: prebuffering demuxing"),this._doProcessPlayDemux()):this._log("play loop: waiting on async/timers");else{let e=a;this._log("play loop: setting a timer for drawing "+e),this._nextFrameTimer=setTimeout(()=>{this._nextFrameTimer=null,this._pingProcessing()},e)}}else this._log("play loop: demuxing"),this._doProcessPlayDemux()}_doProcessPlayDemux(){let e=this._codec.frameReady,t=this._codec.audioReady;this._codec.process(i=>{this._codec.frameReady&&!e||this._codec.audioReady&&!t?(this._log("demuxer has packets"),this._pingProcessing()):i?(this._log("demuxer processing to find more packets"),this._pingProcessing()):(this._log("demuxer ran out of data"),this._streamEnded?(this._log("demuxer reached end of data stream"),this._dataEnded=!0,this._pingProcessing()):(this._log("demuxer loading more data"),this._readBytesAndWait()))})}_doProcessError(){}_isProcessing(){return this._stream&&(this._stream.buffering||this._stream.seeking)||this._codec&&this._codec.processing}_readBytesAndWait(){if(this._stream.buffering||this._stream.seeking)return void this._log("readBytesAndWait during i/o");this._stream.read(32768).then(e=>{this._log("got input "+[e.byteLength]),e.byteLength&&this._actionQueue.push(()=>{this._codec.receiveInput(e,()=>{this._pingProcessing()})}),this._stream.eof&&(this._log("stream is at end!"),this._streamEnded=!0),this._isProcessing()||this._pingProcessing()}).catch(e=>{this._onStreamError(e)})}_pingProcessing(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(this._stream&&this._stream.waiting)return void this._log("waiting on input");this._nextProcessingTimer&&(this._log("canceling old processing timer"),clearTimeout(this._nextProcessingTimer),this._nextProcessingTimer=null);e>-1/256?this._nextProcessingTimer=setTimeout(()=>{this._pingProcessing()},e):this._depth?this._needProcessing=!0:this._doProcessing()}_startProcessingVideo(e){if(this._started||this._codec)return;this._framesProcessed=0,this._bufferTime=0,this._drawingTime=0,this._proxyTime=0,this._started=!0,this._ended=!1;let t={base:this._options.base,worker:this._enableWorker,threading:this._enableThreading,simd:this._enableSIMD};this._detectedType&&(t.type=this._detectedType),this._codec=new _.default(t),this._lastVideoCpuTime=0,this._lastAudioCpuTime=0,this._lastDemuxerCpuTime=0,this._lastBufferTime=0,this._lastDrawingTime=0,this._lastProxyTime=0,this._lastFrameVideoCpuTime=0,this._lastFrameAudioCpuTime=0,this._lastFrameDemuxerCpuTime=0,this._lastFrameBufferTime=0,this._lastFrameProxyTime=0,this._lastFrameDrawingTime=0,this._currentVideoCpuTime=0,this._codec.onseek=e=>{this._didSeek=!0,this._stream&&this._seekStream(e)},this._codec.init(()=>{this._codec.receiveInput(e,()=>{this._readBytesAndWait()})})}_loadCodec(e){this._stream.read(1024).then(t=>{let i=new Uint8Array(t);i.length>4&&i[0]=="O".charCodeAt(0)&&i[1]=="g".charCodeAt(0)&&i[2]=="g".charCodeAt(0)&&i[3]=="S".charCodeAt(0)?this._detectedType="video/ogg":i.length>4&&26==i[0]&&69==i[1]&&223==i[2]&&163==i[3]?this._detectedType="video/webm":this._detectedType="video/ogg",e(t)})}_prepForLoad(e){this._stopVideo();let doLoad=()=>{this._options.stream?this._stream=this._options.stream:this._stream=new s.default({url:this.src,cacheSize:16777216,progressive:!1}),this._stream.load().then(()=>{this._loading=!1,this._currentSrc=this.src,this._byteLength=this._stream.seekable?this._stream.length:0;let e=this._stream.headers["x-content-duration"];"string"==typeof e&&(this._duration=parseFloat(e)),this._loadCodec(e=>{this._startProcessingVideo(e)})}).catch(e=>{this._onStreamError(e)})};this._currentSrc="",this._loading=!0,this._actionQueue.push(()=>{e&&"none"===this.preload?this._loading=!1:doLoad()}),this._pingProcessing(0)}load(){this._prepForLoad()}canPlayType(e){let t=new l.default(e);function checkTypes(e){if(t.codecs){let i=0,r=0;return t.codecs.forEach(t=>{e.indexOf(t)>=0?i++:r++}),0===i?"":r>0?"":"probably"}return"maybe"}return"ogg"!==t.minor||"audio"!==t.major&&"video"!==t.major&&"application"!==t.major?"webm"!==t.minor||"audio"!==t.major&&"video"!==t.major?"":checkTypes(["vorbis","opus","vp8","vp9"]):checkTypes(["vorbis","opus","theora"])}play(){this._muted||this._options.audioContext||OGVPlayer.initSharedAudioContext(),this._paused&&(this._startedPlaybackInDocument=document.body.contains(this),this._paused=!1,this._state==m.SEEKING||(this._started&&this._codec&&this._codec.loadedMetadata?(this._ended&&this._stream&&this._byteLength?(this._log(".play() starting over after end"),this._seek(0)):this._log(".play() while already started"),this._state=m.READY,this._isProcessing()||this._pingProcessing()):this._loading?this._log(".play() while loading"):(this._log(".play() before started"),this._stream||this.load()))),this._video&&this._video.paused&&this._video.play()}getPlaybackStats(){return{targetPerFrameTime:this._targetPerFrameTime,framesProcessed:this._framesProcessed,videoBytes:this._codec?this._codec.videoBytes:0,audioBytes:this._codec?this._codec.audioBytes:0,playTime:this._playTime,demuxingTime:this._codec?this._codec.demuxerCpuTime-this._lastDemuxerCpuTime:0,videoDecodingTime:this._codec?this._codec.videoCpuTime-this._lastVideoCpuTime:0,audioDecodingTime:this._codec?this._codec.audioCpuTime-this._lastAudioCpuTime:0,bufferTime:this._bufferTime-this._lastBufferTime,drawingTime:this._drawingTime-this._lastDrawingTime,proxyTime:this._proxyTime-this._lastProxyTime,droppedAudio:this._droppedAudio,delayedAudio:this._delayedAudio,jitter:this._totalJitter/this._framesProcessed,lateFrames:this._lateFrames}}resetPlaybackStats(){this._framesProcessed=0,this._playTime=0,this._codec&&(this._lastDemuxerCpuTime=this._codec.demuxerCpuTime,this._lastVideoCpuTime=this._codec.videoCpuTime,this._lastAudioCpuTime=this._codec.audioCpuTime,this._codec.videoBytes=0,this._codec.audioBytes=0),this._lastBufferTime=this._bufferTime,this._lastDrawingTime=this._drawingTime,this._lastProxyTime=this._proxyTime,this._totalJitter=0,this._totalFrameTime=0,this._totalFrameCount=0}getVideoFrameSink(){return this._frameSink}getCanvas(){return this._canvas}getVideo(){return this._video}pause(){this._paused||(this._nextProcessingTimer&&(clearTimeout(this._nextProcessingTimer),this._nextProcessingTimer=null),this._stopPlayback(),this._prebufferingAudio=!1,this._paused=!0,this._fireEvent("pause"))}stop(){this._stopVideo(),this._paused=!0}fastSeek(e){this._seek(+e,y.FAST)}}if((0,h.default)(OGVPlayer,p),OGVPlayer.instanceCount=0,OGVPlayer.styleManager=new function StyleManager(){var e=document.createElement("style");e.type="text/css",e.textContent="ogvjs { display: inline-block; position: relative; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0,0,0,0); ",document.head.appendChild(e);var t=e.sheet;this.appendRule=function(e,i){var r=[];for(var o in i)i.hasOwnProperty(o)&&r.push(o+":"+i[o]);var s=e+"{"+r.join(";")+"}";t.insertRule(s,t.cssRules.length-1)}},OGVPlayer.supportsObjectFit="string"==typeof document.createElement("canvas").style.objectFit,OGVPlayer.supportsObjectFit&&navigator.userAgent.match(/iPhone|iPad|iPod Touch/)&&(OGVPlayer.supportsObjectFit=!1),OGVPlayer.supportsObjectFit&&navigator.userAgent.match(/Edge/)&&(OGVPlayer.supportsObjectFit=!1),OGVPlayer.supportsObjectFit)OGVPlayer.updatePositionOnResize=function(){};else{OGVPlayer.updatePositionOnResize=function(){function fixup(e,t,i){var r=e.offsetParent||e.parentNode,o=t/i;if(o>r.offsetWidth/r.offsetHeight){var s=r.offsetWidth/o,n=(r.offsetHeight-s)/2;e.style.width="100%",e.style.height=s+"px",e.style.marginLeft=0,e.style.marginRight=0,e.style.marginTop=n+"px",e.style.marginBottom=n+"px"}else{var a=r.offsetHeight*o,d=(r.offsetWidth-a)/2;e.style.width=a+"px",e.style.height="100%",e.style.marginLeft=d+"px",e.style.marginRight=d+"px",e.style.marginTop=0,e.style.marginBottom=0}}function queryOver(e,t){var i=document.querySelectorAll(e);Array.prototype.slice.call(i).forEach(t)}queryOver("ogvjs > canvas",(function(e){fixup(e,e.width,e.height)})),queryOver("ogvjs > img",(function(e){fixup(e,e.naturalWidth,e.naturalHeight)}))};var b=function fullResizeVideo(){e(OGVPlayer.updatePositionOnResize)};window.addEventListener("resize",OGVPlayer.updatePositionOnResize),window.addEventListener("orientationchange",OGVPlayer.updatePositionOnResize),document.addEventListener("fullscreenchange",b),document.addEventListener("mozfullscreenchange",b),document.addEventListener("webkitfullscreenchange",b),document.addEventListener("MSFullscreenChange",b)}var T=OGVPlayer;t.default=T}).call(this,i(19).setImmediate)},function(e,t,i){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function Timeout(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new Timeout(o.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new Timeout(o.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function onTimeout(){e._onTimeout&&e._onTimeout()}),t))},i(20),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,i(8))},function(e,t,i){(function(e,t){!function(e,i){"use strict";if(!e.setImmediate){var r,o=1,s={},n=!1,a=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?function installNextTickImplementation(){r=function(e){t.nextTick((function(){runIfPresent(e)}))}}():!function canUsePostMessage(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?e.MessageChannel?function installMessageChannelImplementation(){var e=new MessageChannel;e.port1.onmessage=function(e){runIfPresent(e.data)},r=function(t){e.port2.postMessage(t)}}():a&&"onreadystatechange"in a.createElement("script")?function installReadyStateChangeImplementation(){var e=a.documentElement;r=function(t){var i=a.createElement("script");i.onreadystatechange=function(){runIfPresent(t),i.onreadystatechange=null,e.removeChild(i),i=null},e.appendChild(i)}}():function installSetTimeoutImplementation(){r=function(e){setTimeout(runIfPresent,0,e)}}():function installPostMessageImplementation(){var t="setImmediate$"+Math.random()+"$",onGlobalMessage=function(i){i.source===e&&"string"==typeof i.data&&0===i.data.indexOf(t)&&runIfPresent(+i.data.slice(t.length))};e.addEventListener?e.addEventListener("message",onGlobalMessage,!1):e.attachEvent("onmessage",onGlobalMessage),r=function(i){e.postMessage(t+i,"*")}}(),d.setImmediate=function setImmediate(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var n={callback:e,args:t};return s[o]=n,r(o),o++},d.clearImmediate=clearImmediate}function clearImmediate(e){delete s[e]}function runIfPresent(e){if(n)setTimeout(runIfPresent,0,e);else{var t=s[e];if(t){n=!0;try{!function run(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(i,r)}}(t)}finally{clearImmediate(e),n=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,i(8),i(21))},function(e,t){var i,r,o=e.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(i===setTimeout)return setTimeout(e,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){i=defaultSetTimout}try{r="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){r=defaultClearTimeout}}();var s,n=[],a=!1,d=-1;function cleanUpNextTick(){a&&s&&(a=!1,s.length?n=s.concat(n):d=-1,n.length&&drainQueue())}function drainQueue(){if(!a){var e=runTimeout(cleanUpNextTick);a=!0;for(var t=n.length;t;){for(s=n,n=[];++d<t;)s&&s[d].run();d=-1,t=n.length}s=null,a=!1,function runClearTimeout(e){if(r===clearTimeout)return clearTimeout(e);if((r===defaultClearTimeout||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];n.push(new Item(e,t)),1!==n.length||a||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=noop,o.addListener=noop,o.once=noop,o.off=noop,o.removeListener=noop,o.removeAllListeners=noop,o.emit=noop,o.prependListener=noop,o.prependOnceListener=noop,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,i){!function(){"use strict";var t=i(2),r=i(23),o=i(26),s={FrameSink:t,SoftwareFrameSink:r,WebGLFrameSink:o,attach:function(e,t){return("webGL"in(t=t||{})?t.webGL:o.isAvailable())?new o(e,t):new r(e,t)}};e.exports=s}()},function(e,t,i){!function(){"use strict";var t=i(2),r=i(24);function SoftwareFrameSink(e){var t=e.getContext("2d"),i=null,o=null,s=null;return this.drawFrame=function drawFrame(n){var a=n.format;e.width===a.displayWidth&&e.height===a.displayHeight||(e.width=a.displayWidth,e.height=a.displayHeight),null!==i&&i.width==a.width&&i.height==a.height||function initImageData(e,r){for(var o=(i=t.createImageData(e,r)).data,s=e*r*4,n=0;n<s;n+=4)o[n+3]=255}(a.width,a.height),r.convertYCbCr(n,i.data);var d,u=a.cropWidth!=a.displayWidth||a.cropHeight!=a.displayHeight;u?(o||function initResampleCanvas(e,t){(o=document.createElement("canvas")).width=e,o.height=t,s=o.getContext("2d")}(a.cropWidth,a.cropHeight),d=s):d=t,d.putImageData(i,-a.cropLeft,-a.cropTop,a.cropLeft,a.cropTop,a.cropWidth,a.cropHeight),u&&t.drawImage(o,0,0,a.displayWidth,a.displayHeight)},this.clear=function(){t.clearRect(0,0,e.width,e.height)},this}SoftwareFrameSink.prototype=Object.create(t.prototype),e.exports=SoftwareFrameSink}()},function(e,t,i){!function(){"use strict";var t=i(25);
/**
	 * Basic YCbCr->RGB conversion
	 *
	 * @author Brion Vibber <brion@pobox.com>
	 * @copyright 2014-2019
	 * @license MIT-style
	 *
	 * @param {YUVFrame} buffer - input frame buffer
	 * @param {Uint8ClampedArray} output - array to draw RGBA into
	 * Assumes that the output array already has alpha channel set to opaque.
	 */e.exports={convertYCbCr:function convertYCbCr(e,i){var r=0|e.format.width,o=0|e.format.height,s=0|t(e.format.width/e.format.chromaWidth),n=0|t(e.format.height/e.format.chromaHeight),a=e.y.bytes,d=e.u.bytes,u=e.v.bytes,h=0|e.y.stride,c=0|e.u.stride,l=0|e.v.stride,f=r<<2,_=0,p=0,m=0,g=0,y=0,v=0,b=0,T=0,w=0,k=0,E=0,P=0,A=0,x=0,R=0,O=0,S=0,F=0;if(1==s&&1==n)for(b=0,T=f,F=0,O=0;O<o;O+=2){for(m=(p=O*h|0)+h|0,g=F*c|0,y=F*l|0,R=0;R<r;R+=2)w=0|d[g++],P=(409*(k=0|u[y++])|0)-57088|0,A=(100*w|0)+(208*k|0)-34816|0,x=(516*w|0)-70912|0,E=298*a[p++]|0,i[b]=E+P>>8,i[b+1]=E-A>>8,i[b+2]=E+x>>8,b+=4,E=298*a[p++]|0,i[b]=E+P>>8,i[b+1]=E-A>>8,i[b+2]=E+x>>8,b+=4,E=298*a[m++]|0,i[T]=E+P>>8,i[T+1]=E-A>>8,i[T+2]=E+x>>8,T+=4,E=298*a[m++]|0,i[T]=E+P>>8,i[T+1]=E-A>>8,i[T+2]=E+x>>8,T+=4;b+=f,T+=f,F++}else for(v=0,O=0;O<o;O++)for(S=0,_=O*h|0,g=(F=O>>n)*c|0,y=F*l|0,R=0;R<r;R++)w=0|d[g+(S=R>>s)],P=(409*(k=0|u[y+S])|0)-57088|0,A=(100*w|0)+(208*k|0)-34816|0,x=(516*w|0)-70912|0,E=298*a[_++]|0,i[v]=E+P>>8,i[v+1]=E-A>>8,i[v+2]=E+x>>8,v+=4}}}()},function(e,t){!function(){"use strict";
/**
   * Convert a ratio into a bit-shift count; for instance a ratio of 2
   * becomes a bit-shift of 1, while a ratio of 1 is a bit-shift of 0.
   *
   * @author Brion Vibber <brion@pobox.com>
   * @copyright 2016
   * @license MIT-style
   *
   * @param {number} ratio - the integer ratio to convert.
   * @returns {number} - number of bits to shift to multiply/divide by the ratio.
   * @throws exception if given a non-power-of-two
   */e.exports=function depower(e){for(var t=0,i=e>>1;0!=i;)i>>=1,t++;if(e!==1<<t)throw"chroma plane dimensions must be power of 2 ratio to luma plane dimensions; got "+e;return t}}()},function(e,t,i){!function(){"use strict";var t=i(2),r=i(27);function WebGLFrameSink(e){var t,i,o=this,s=WebGLFrameSink.contextForCanvas(e);if(null===s)throw new Error("WebGL unavailable");function compileShader(e,t){var i=s.createShader(e);if(s.shaderSource(i,t),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS)){var r=s.getShaderInfoLog(i);throw s.deleteShader(i),new Error("GL shader compilation for "+e+" failed: "+r)}return i}var n,a,d,u,h,c,l,f,_,p,m=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),g={},y={},v={};function createOrReuseTexture(e){return g[e]||(g[e]=s.createTexture()),g[e]}function uploadTexture(e,t,i,r){var o=createOrReuseTexture(e);if(s.activeTexture(s.TEXTURE0),WebGLFrameSink.stripe){var n=!g[e+"_temp"],a=createOrReuseTexture(e+"_temp");s.bindTexture(s.TEXTURE_2D,a),n?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t/4,i,0,s.RGBA,s.UNSIGNED_BYTE,r)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,t/4,i,s.RGBA,s.UNSIGNED_BYTE,r);var d=g[e+"_stripe"],u=!d;u&&(d=createOrReuseTexture(e+"_stripe")),s.bindTexture(s.TEXTURE_2D,d),u&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,1,0,s.RGBA,s.UNSIGNED_BYTE,function buildStripe(e){if(v[e])return v[e];for(var t=e,i=new Uint32Array(t),r=0;r<t;r+=4)i[r]=255,i[r+1]=65280,i[r+2]=16711680,i[r+3]=4278190080;return v[e]=new Uint8Array(i.buffer)}(t)))}else s.bindTexture(s.TEXTURE_2D,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,t,i,0,s.LUMINANCE,s.UNSIGNED_BYTE,r)}function unpackTexture(e,t,r){var o=g[e];s.useProgram(i);var l=y[e];l||(s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,r,0,s.RGBA,s.UNSIGNED_BYTE,null),l=y[e]=s.createFramebuffer()),s.bindFramebuffer(s.FRAMEBUFFER,l),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,o,0);var f=g[e+"_temp"];s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,f),s.uniform1i(c,1);var _=g[e+"_stripe"];s.activeTexture(s.TEXTURE2),s.bindTexture(s.TEXTURE_2D,_),s.uniform1i(h,2),s.bindBuffer(s.ARRAY_BUFFER,n),s.enableVertexAttribArray(a),s.vertexAttribPointer(a,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,d),s.enableVertexAttribArray(u),s.vertexAttribPointer(u,2,s.FLOAT,!1,0,0),s.viewport(0,0,t,r),s.drawArrays(s.TRIANGLES,0,m.length/2),s.bindFramebuffer(s.FRAMEBUFFER,null)}function attachTexture(e,i,r){s.activeTexture(i),s.bindTexture(s.TEXTURE_2D,g[e]),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.uniform1i(s.getUniformLocation(t,e),r)}function initProgram(e,t){var i=compileShader(s.VERTEX_SHADER,e),r=compileShader(s.FRAGMENT_SHADER,t),o=s.createProgram();if(s.attachShader(o,i),s.attachShader(o,r),s.linkProgram(o),!s.getProgramParameter(o,s.LINK_STATUS)){var n=s.getProgramInfoLog(o);throw s.deleteProgram(o),new Error("GL program linking failed: "+n)}return o}return o.drawFrame=function(g){var y=g.format,v=!t||e.width!==y.displayWidth||e.height!==y.displayHeight;if(v&&(e.width=y.displayWidth,e.height=y.displayHeight,o.clear()),t||function init(){if(WebGLFrameSink.stripe){i=initProgram(r.vertexStripe,r.fragmentStripe),s.getAttribLocation(i,"aPosition"),d=s.createBuffer();var e=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);s.bindBuffer(s.ARRAY_BUFFER,d),s.bufferData(s.ARRAY_BUFFER,e,s.STATIC_DRAW),u=s.getAttribLocation(i,"aTexturePosition"),h=s.getUniformLocation(i,"uStripe"),c=s.getUniformLocation(i,"uTexture")}t=initProgram(r.vertex,r.fragment),n=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,m,s.STATIC_DRAW),a=s.getAttribLocation(t,"aPosition"),l=s.createBuffer(),f=s.getAttribLocation(t,"aLumaPosition"),_=s.createBuffer(),p=s.getAttribLocation(t,"aChromaPosition")}(),v){var setupTexturePosition=function(e,t,i){var r=y.cropLeft/i,o=(y.cropLeft+y.cropWidth)/i,n=(y.cropTop+y.cropHeight)/y.height,a=y.cropTop/y.height,d=new Float32Array([r,n,o,n,r,a,r,a,o,n,o,a]);s.bindBuffer(s.ARRAY_BUFFER,e),s.bufferData(s.ARRAY_BUFFER,d,s.STATIC_DRAW)};setupTexturePosition(l,0,g.y.stride),setupTexturePosition(_,0,g.u.stride*y.width/y.chromaWidth)}uploadTexture("uTextureY",g.y.stride,y.height,g.y.bytes),uploadTexture("uTextureCb",g.u.stride,y.chromaHeight,g.u.bytes),uploadTexture("uTextureCr",g.v.stride,y.chromaHeight,g.v.bytes),WebGLFrameSink.stripe&&(unpackTexture("uTextureY",g.y.stride,y.height),unpackTexture("uTextureCb",g.u.stride,y.chromaHeight),unpackTexture("uTextureCr",g.v.stride,y.chromaHeight)),s.useProgram(t),s.viewport(0,0,e.width,e.height),attachTexture("uTextureY",s.TEXTURE0,0),attachTexture("uTextureCb",s.TEXTURE1,1),attachTexture("uTextureCr",s.TEXTURE2,2),s.bindBuffer(s.ARRAY_BUFFER,n),s.enableVertexAttribArray(a),s.vertexAttribPointer(a,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,l),s.enableVertexAttribArray(f),s.vertexAttribPointer(f,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,_),s.enableVertexAttribArray(p),s.vertexAttribPointer(p,2,s.FLOAT,!1,0,0),s.drawArrays(s.TRIANGLES,0,m.length/2)},o.clear=function(){s.viewport(0,0,e.width,e.height),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT)},o.clear(),o}WebGLFrameSink.stripe=-1!==navigator.userAgent.indexOf("Windows"),WebGLFrameSink.contextForCanvas=function(e){var t={preferLowPowerToHighPerformance:!0,powerPreference:"low-power",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!0};return e.getContext("webgl",t)||e.getContext("experimental-webgl",t)},WebGLFrameSink.isAvailable=function(){var e,t=document.createElement("canvas");t.width=1,t.height=1;try{e=WebGLFrameSink.contextForCanvas(t)}catch(e){return!1}if(e){var i=e.TEXTURE0,r=e.createTexture(),o=new Uint8Array(16),s=WebGLFrameSink.stripe?1:4,n=WebGLFrameSink.stripe?e.RGBA:e.LUMINANCE,a=WebGLFrameSink.stripe?e.NEAREST:e.LINEAR;return e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texImage2D(e.TEXTURE_2D,0,n,s,4,0,n,e.UNSIGNED_BYTE,o),!e.getError()}return!1},WebGLFrameSink.prototype=Object.create(t.prototype),e.exports=WebGLFrameSink}()},function(e,t){e.exports={vertex:"precision lowp float;\n\nattribute vec2 aPosition;\nattribute vec2 aLumaPosition;\nattribute vec2 aChromaPosition;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vLumaPosition = aLumaPosition;\n    vChromaPosition = aChromaPosition;\n}\n",fragment:"// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js\n\nprecision lowp float;\n\nuniform sampler2D uTextureY;\nuniform sampler2D uTextureCb;\nuniform sampler2D uTextureCr;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n   // Y, Cb, and Cr planes are uploaded as LUMINANCE textures.\n   float fY = texture2D(uTextureY, vLumaPosition).x;\n   float fCb = texture2D(uTextureCb, vChromaPosition).x;\n   float fCr = texture2D(uTextureCr, vChromaPosition).x;\n\n   // Premultipy the Y...\n   float fYmul = fY * 1.1643828125;\n\n   // And convert that to RGB!\n   gl_FragColor = vec4(\n     fYmul + 1.59602734375 * fCr - 0.87078515625,\n     fYmul - 0.39176171875 * fCb - 0.81296875 * fCr + 0.52959375,\n     fYmul + 2.017234375   * fCb - 1.081390625,\n     1\n   );\n}\n",vertexStripe:"precision lowp float;\n\nattribute vec2 aPosition;\nattribute vec2 aTexturePosition;\nvarying vec2 vTexturePosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vTexturePosition = aTexturePosition;\n}\n",fragmentStripe:"// extra 'stripe' texture fiddling to work around IE 11's poor performance on gl.LUMINANCE and gl.ALPHA textures\n\nprecision lowp float;\n\nuniform sampler2D uStripe;\nuniform sampler2D uTexture;\nvarying vec2 vTexturePosition;\nvoid main() {\n   // Y, Cb, and Cr planes are mapped into a pseudo-RGBA texture\n   // so we can upload them without expanding the bytes on IE 11\n   // which doesn't allow LUMINANCE or ALPHA textures\n   // The stripe textures mark which channel to keep for each pixel.\n   // Each texture extraction will contain the relevant value in one\n   // channel only.\n\n   float fLuminance = dot(\n      texture2D(uStripe, vTexturePosition),\n      texture2D(uTexture, vTexturePosition)\n   );\n\n   gl_FragColor = vec4(fLuminance, fLuminance, fLuminance, 1);\n}\n"}},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();i(9);var o=i(29),s=i(32),n=function(){function StreamFile(e){var t=e.url,i=void 0===t?"":t,r=e.chunkSize,s=void 0===r?1048576:r,n=e.cacheSize,a=void 0===n?0:n,d=e.progressive,u=void 0===d||d;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StreamFile),this.length=-1,this.loaded=!1,this.loading=!1,this.seekable=!1,this.buffering=!1,this.seeking=!1,this.progressive=u,Object.defineProperties(this,{offset:{get:function get(){return this._cache.readOffset}},eof:{get:function get(){return this.length===this._cache.readOffset}}}),this.url=i,this.headers={},this._cache=new o({cacheSize:a}),this._backend=null,this._cachever=0,this._chunkSize=s}return r(StreamFile,[{key:"load",value:function load(){var e=this;return new Promise((function(t,i){if(e.loading)throw new Error("cannot load when loading");if(e.loaded)throw new Error("cannot load when loaded");e.loading=!0,e._openBackend().then((function(i){e.seekable=i.seekable,e.headers=i.headers,e.length=i.length,e.loaded=!0,e.loading=!1,t()})).catch((function(t){"AbortError"!==t.name&&(e.loading=!1),i(t)}))}))}},{key:"_openBackend",value:function _openBackend(){var e=this;return new Promise((function(t,i){if(e._backend)t(e._backend);else if(e.eof)i(new Error("cannot open at end of file"));else{var r=e._cache,o=e._chunkSize,n=r.bytesReadable(o),a=r.readOffset+n;if(r.seekWrite(a),e.length>=0&&a>=e.length)return void t(null);var d=e._clampToLength(r.writeOffset+r.bytesWritable(o))-r.writeOffset;if(0===d)t(null);else{var u=e._backend=new s({url:e.url,offset:e._cache.writeOffset,length:d,cachever:e._cachever,progressive:e.progressive}),h=null,c=function checkOpen(){u!==e._backend?(h(),i(new Error("invalid state"))):(u.on("buffer",(function(t){u===e._backend&&e._cache.write(t)})),u.on("done",(function(){u===e._backend&&(-1===e.length&&(e.length=e._backend.offset+e._backend.bytesRead),e._backend=null)})),t(u))},l=function checkError(t){u!==e._backend?i(new Error("invalid state")):(e._backend=null,i(t))};h=function oncomplete(){u.off("open",c),u.off("error",l)},u.on("open",c),u.on("error",l),u.on("cachever",(function(){e._cachever++})),u.load()}}}))}},{key:"_readAhead",value:function _readAhead(){var e=this;return new Promise((function(t,i){e._backend||e.eof?t():e._openBackend().then((function(){t()})).catch((function(e){i(e)}))}))}},{key:"seek",value:function seek(e){var t=this;return new Promise((function(i,r){if(!t.loaded||t.buffering||t.seeking)throw new Error("invalid state");if(e!==(0|e)||e<0)throw new Error("invalid input");if(t.length>=0&&e>t.length)throw new Error("seek past end of file");if(!t.seekable)throw new Error("seek on non-seekable stream");t._backend&&t.abort(),t._cache.seekRead(e),t._cache.seekWrite(e),t._readAhead().then(i).catch(r)}))}},{key:"read",value:function read(e){var t=this;return this.buffer(e).then((function(e){return t.readSync(e)}))}},{key:"readSync",value:function readSync(e){var t=this.bytesAvailable(e),i=new Uint8Array(t);if(this.readBytes(i)!==t)throw new Error("failed to read expected data");return i.buffer}},{key:"readBytes",value:function readBytes(e){if(!this.loaded||this.buffering||this.seeking)throw new Error("invalid state");if(!(e instanceof Uint8Array))throw new Error("invalid input");var t=this._cache.readBytes(e);return this._readAhead(),t}},{key:"buffer",value:function buffer(e){var t=this;return new Promise((function(i,r){if(!t.loaded||t.buffering||t.seeking)throw new Error("invalid state");if(e!==(0|e)||e<0)throw new Error("invalid input");var o=t._clampToLength(t.offset+e),s=o-t.offset,n=t.bytesAvailable(s);n>=s?i(n):(t.buffering=!0,t._openBackend().then((function(i){return i?i.bufferToOffset(o).then((function(){return t.buffering=!1,t.buffer(e)})):Promise.resolve(n)})).then((function(e){t.buffering=!1,i(e)})).catch((function(e){"AbortError"!==e.name&&(t.buffering=!1),r(e)})))}))}},{key:"bytesAvailable",value:function bytesAvailable(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;return this._cache.bytesReadable(e)}},{key:"abort",value:function abort(){this.loading&&(this.loading=!1),this.buffering&&(this.buffering=!1),this.seeking&&(this.seeking=!1),this._backend&&(this._backend.abort(),this._backend=null)}},{key:"getBufferedRanges",value:function getBufferedRanges(){return this._cache.ranges()}},{key:"_clampToLength",value:function _clampToLength(e){return this.length<0?e:Math.min(this.length,e)}}]),StreamFile}();e.exports=n},function(e,t,i){"use strict";e.exports=i(30)},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var o=i(31),s=function(){function CachePool(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).cacheSize,t=void 0===e?0:e;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CachePool);var i=new o({eof:!0});this.head=i,this.tail=i,this.readOffset=0,this.readCursor=i,this.writeOffset=0,this.writeCursor=i,this.cacheSize=t}return r(CachePool,[{key:"bytesReadable",value:function bytesReadable(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=this.readOffset,i=this.readCursor,r=i.last((function(i){return!i.empty&&i.start<=t+e}));return r?Math.min(e,r.end-t):0}},{key:"bytesWritable",value:function bytesWritable(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=this.writeOffset,i=this.writeCursor;if(i.eof)return e;var r=i.last((function(i){return i.empty&&i.start<=t+e}));return r?Math.min(e,r.end-t):0}},{key:"seekRead",value:function seekRead(e){var t=this.head.first((function(t){return t.contains(e)}));if(!t)throw new Error("read seek out of range");this.readOffset=e,this.readCursor=t}},{key:"seekWrite",value:function seekWrite(e){var t=this.head.first((function(t){return t.contains(e)}));if(!t)throw new Error("write seek out of range");this.writeOffset=e,this.writeCursor=t}},{key:"readBytes",value:function readBytes(e){for(var t=e.byteLength,i=this.bytesReadable(t),r=this.readOffset,o=r+i,s=r,n=this.readCursor;n&&!n.empty&&!(n.start>=o);n=n.next){var a=Math.min(o,n.end),d=e.subarray(s-r,a-r);n.readBytes(d,s,a),s=a}return this.readOffset=s,this.readCursor=this.readCursor.first((function(e){return e.contains(s)})),i}},{key:"write",value:function write(e){var t=this.bufferItem(e),i=this.writeCursor;if(!i.empty)throw new Error("write cursor not empty");if(!i.contains(t.end)&&i.end!==t.end)throw new Error("write cursor too small");i.start<t.start&&(this.split(i,t.start),i=this.writeCursor),(t.end<i.end||i.eof)&&(this.split(i,t.end),i=this.writeCursor),this.splice(i,i,t,t),this.writeOffset=t.end,this.writeCursor=t.next,this.gc()}},{key:"bufferItem",value:function bufferItem(e){if(e instanceof ArrayBuffer)return new o({start:this.writeOffset,end:this.writeOffset+e.byteLength,buffer:e});if("string"==typeof e)return new o({start:this.writeOffset,end:this.writeOffset+e.length,string:e});throw new Error("invalid input to write")}},{key:"split",value:function split(e,t){var i=e.split(t);this.splice(e,e,i[0],i[1])}},{key:"ranges",value:function ranges(){for(var ranges=[],e=this.head;e;e=e.next)if(!e.empty){var t=e;e=e.last((function(e){return!e.empty})),ranges.push([t.start,e.end])}return ranges}},{key:"gc",value:function gc(){for(var e=0,t=[],i=this.head;i;i=i.next)i.empty||(e+=i.length,(i.end<this.readOffset||i.start>this.readOffset+this.chunkSize)&&t.push(i));if(e>this.cacheSize){t.sort((function(e,t){return e.timestamp-t.timestamp}));for(var r=0;r<t.length;r++){var o=t[r];if(e<=this.cacheSize)break;this.remove(o),e-=o.length}}}},{key:"remove",value:function remove(e){var t=new o({start:e.start,end:e.end});this.splice(e,e,t,t),(e=t).prev&&e.prev.empty&&(e=this.consolidate(e.prev)),e.next&&e.next.empty&&!e.next.eof&&(e=this.consolidate(e)),0===e.start&&(this.head=e)}},{key:"consolidate",value:function consolidate(e){var t=e.last((function(e){return e.empty&&!e.eof})),i=new o({start:e.start,end:t.end});return this.splice(e,t,i,i),i}},{key:"splice",value:function splice(e,t,i,r){var o=this;if(e.start!==i.start)throw new Error("invalid splice head");if(!(t.end===r.end||t.eof&&r.eof))throw new Error("invalid splice tail");var s=e.prev,n=t.next;e.prev=null,t.next=null,s&&(s.next=i,i.prev=s),n&&(n.prev=r,r.next=n),e===this.head&&(this.head=i),t===this.tail&&(this.tail=r),this.readCursor=this.head.first((function(e){return e.contains(o.readOffset)})),this.writeCursor=this.head.first((function(e){return e.contains(o.writeOffset)}))}},{key:"eof",get:function get(){return this.readCursor.eof}}]),CachePool}();e.exports=s},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var o=function(){function CacheItem(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.buffer,i=void 0===t?void 0:t,r=e.string,o=void 0===r?void 0:r,s=e.start,n=void 0===s?0:s,a=e.end,d=void 0===a?n+(i?i.byteLength:o?o.length:0):a,u=e.prev,h=void 0===u?null:u,c=e.next,l=void 0===c?null:c,f=e.eof,_=void 0!==f&&f,p=e.empty,m=void 0===p?!(i||o):p,g=e.timestamp,y=void 0===g?Date.now():g;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CacheItem),this.start=n,this.end=d,this.prev=h,this.next=l,this.eof=_,this.empty=m,this.timestamp=y,this.buffer=i,this.string=o,Object.defineProperty(this,"length",{get:function get(){return this.end-this.start}})}return r(CacheItem,[{key:"contains",value:function contains(e){return e>=this.start&&(e<this.end||this.eof)}},{key:"readBytes",value:function readBytes(e,t,i){var r=t-this.start,o=i-t;if(this.buffer){var s=new Uint8Array(this.buffer,r,o);e.set(s)}else{if(!this.string)throw new Error("invalid state");for(var n=this.string,a=0;a<o;a++)e[a]=n.charCodeAt(r+a)}this.timestamp=Date.now()}},{key:"split",value:function split(e){if(!this.empty||!this.contains(e))throw new Error("invalid split");var t=new CacheItem({start:this.start,end:e}),i=new CacheItem({start:e,end:this.eof?e:this.end,eof:this.eof});return t.next=i,i.prev=t,[t,i]}},{key:"first",value:function first(e){for(var t=this;t;t=t.next)if(e(t))return t;return null}},{key:"last",value:function last(e){for(var last=null,t=this;t&&e(t);t=t.next)last=t;return last}}]),CacheItem}();e.exports=o},function(e,t,i){"use strict";var r=i(33),o=i(35),s=i(36);var n=null;e.exports=function instantiate(e){if(!1===e.progressive)return new s(e);if(n||(n=function autoselect(){return r.supported()?r:o.supported()?o:null}()),!n)throw new Error("No supported backend class");return new n(e)}},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();var o=i(3),s="moz-chunked-arraybuffer",n=function(e){function MozChunkedBackend(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MozChunkedBackend),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(MozChunkedBackend.__proto__||Object.getPrototypeOf(MozChunkedBackend)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(MozChunkedBackend,e),r(MozChunkedBackend,[{key:"initXHR",value:function initXHR(){(function get(e,t,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,i)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(i):void 0})(MozChunkedBackend.prototype.__proto__||Object.getPrototypeOf(MozChunkedBackend.prototype),"initXHR",this).call(this),this.xhr.responseType=s}},{key:"onXHRProgress",value:function onXHRProgress(){var e=this.xhr.response;this.bytesRead+=e.byteLength,this.emit("buffer",e)}}]),MozChunkedBackend}(o);n.supported=function(){try{var e=new XMLHttpRequest;return e.responseType=s,e.responseType===s}catch(e){return!1}},e.exports=n},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}();function getXHRLength(e){if(206==e.status)return function getXHRRangeTotal(e){var t=getXHRRangeMatches(e);return t?parseInt(t[3],10):-1}(e);var t=e.getResponseHeader("Content-Length");return null===t||""===t?-1:parseInt(t,10)}function getXHRRangeMatches(e){var t=e.getResponseHeader("Content-Range");return t&&t.match(/^bytes (\d+)-(\d+)\/(\d+)/)}var o=function(e){function Backend(e){var t=e.url,i=e.offset,r=e.length,o=e.cachever,s=void 0===o?0:o;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Backend);var n=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Backend.__proto__||Object.getPrototypeOf(Backend)).call(this));return n.url=t,n.offset=i,n.length=r,n.cachever=s,n.loaded=!1,n.seekable=!1,n.headers={},n.eof=!1,n.bytesRead=0,n.xhr=new XMLHttpRequest,n}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Backend,e),r(Backend,[{key:"load",value:function load(){var e=this;return new Promise((function(t,i){var r=null;e._onAbort=function(e){r(),i(e)};var o=function checkOpen(){if(2==e.xhr.readyState){if(206==e.xhr.status){var o=function getXHRRangeStart(e){var t=getXHRRangeMatches(e);return t?parseInt(t[1],10):0}(e.xhr);if(e.offset!=o)return console.log("Expected start at "+e.offset+" but got "+o+"; working around Safari range caching bug: https://bugs.webkit.org/show_bug.cgi?id=82672"),e.cachever++,e.emit("cachever"),e.abort(),r(),void e.load().then(t).catch(i);e.seekable=!0}e.xhr.status>=200&&e.xhr.status<300?(e.length=getXHRLength(e.xhr),e.headers=function getXHRHeaders(e){var t={};return e.getAllResponseHeaders().split(/\r?\n/).forEach((function(e){var i=e.split(/:\s*/,2);i.length>1&&(t[i[0].toLowerCase()]=i[1])})),t}(e.xhr),e.onXHRStart()):(r(),i(new Error("HTTP error "+e.xhr.status)))}},s=function checkError(){r(),i(new Error("network error"))},n=function checkBackendOpen(){r(),t()};r=function oncomplete(){e.xhr.removeEventListener("readystatechange",o),e.xhr.removeEventListener("error",s),e.off("open",n),e._onAbort=null},e.initXHR(),e.xhr.addEventListener("readystatechange",o),e.xhr.addEventListener("error",s),e.on("open",n),e.xhr.send()}))}},{key:"bufferToOffset",value:function bufferToOffset(e){return Promise.reject(new Error("abstract"))}},{key:"abort",value:function abort(){if(this.xhr.abort(),this._onAbort){var e=this._onAbort;this._onAbort=null;var t=new Error("Aborted");t.name="AbortError",e(t)}}},{key:"initXHR",value:function initXHR(){var e=this.url;this.cachever&&(e+="?buggy_cachever="+this.cachever),this.xhr.open("GET",e);var t=null;(this.offset||this.length)&&(t="bytes="+this.offset+"-"),this.length&&(t+=this.offset+this.length-1),null!==t&&this.xhr.setRequestHeader("Range",t)}},{key:"onXHRStart",value:function onXHRStart(){throw new Error("abstract")}}]),Backend}(i(9));e.exports=o},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}(),o=function get(e,t,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,i)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(i):void 0};var s=function(e){function BinaryStringBackend(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,BinaryStringBackend),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(BinaryStringBackend.__proto__||Object.getPrototypeOf(BinaryStringBackend)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(BinaryStringBackend,e),r(BinaryStringBackend,[{key:"initXHR",value:function initXHR(){o(BinaryStringBackend.prototype.__proto__||Object.getPrototypeOf(BinaryStringBackend.prototype),"initXHR",this).call(this),this.xhr.responseType="text",this.xhr.overrideMimeType("text/plain; charset=x-user-defined")}},{key:"onXHRProgress",value:function onXHRProgress(){var e=this.xhr.responseText.slice(this.bytesRead);e.length>0&&(this.bytesRead+=e.length,this.emit("buffer",e))}},{key:"onXHRLoad",value:function onXHRLoad(){this.onXHRProgress(),o(BinaryStringBackend.prototype.__proto__||Object.getPrototypeOf(BinaryStringBackend.prototype),"onXHRLoad",this).call(this)}}]),BinaryStringBackend}(i(3));s.supported=function(){try{return!!(new XMLHttpRequest).overrideMimeType}catch(e){return!1}},e.exports=s},function(e,t,i){"use strict";var r=function(){function defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&defineProperties(e.prototype,t),i&&defineProperties(e,i),e}}(),o=function get(e,t,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,i)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(i):void 0};var s=i(3),n="arraybuffer",a=function(e){function ArrayBufferBackend(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ArrayBufferBackend),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ArrayBufferBackend.__proto__||Object.getPrototypeOf(ArrayBufferBackend)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ArrayBufferBackend,e),r(ArrayBufferBackend,[{key:"initXHR",value:function initXHR(){o(ArrayBufferBackend.prototype.__proto__||Object.getPrototypeOf(ArrayBufferBackend.prototype),"initXHR",this).call(this),this.xhr.responseType=n}},{key:"onXHRProgress",value:function onXHRProgress(){}},{key:"onXHRLoad",value:function onXHRLoad(){var e=this.xhr.response;this.bytesRead+=e.byteLength,this.emit("buffer",e),o(ArrayBufferBackend.prototype.__proto__||Object.getPrototypeOf(ArrayBufferBackend.prototype),"onXHRLoad",this).call(this)}}]),ArrayBufferBackend}(s);a.supported=function(){try{var e=new XMLHttpRequest;return e.responseType=n,e.responseType===n}catch(e){return!1}},e.exports=a},function(e,t,i){window,e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){
/**
 * @file Abstraction around a queue of audio buffers.
 *
 * @author Brion Vibber <brion@pobox.com>
 * @copyright (c) 2013-2016 Brion Vibber
 * @license MIT
 */
function r(e,t){if(e<1||e!==Math.round(e))throw"Invalid channel count for BufferQueue";this.channels=e,this.bufferSize=t,this.flush()}r.prototype.flush=function(){this._buffers=[],this._pendingBuffer=this.createBuffer(this.bufferSize),this._pendingPos=0},r.prototype.sampleCount=function(){var e=0;return this._buffers.forEach((function(t){e+=t[0].length})),e},r.prototype.createBuffer=function(e){for(var t=[],i=0;i<this.channels;i++)t[i]=new Float32Array(e);return t},r.prototype.validate=function(e){if(e.length!==this.channels)return!1;for(var t,i=0;i<e.length;i++){var r=e[i];if(!(r instanceof Float32Array))return!1;if(0==i)t=r.length;else if(r.length!==t)return!1}return!0},r.prototype.appendBuffer=function(e){if(!this.validate(e))throw"Invalid audio buffer passed to BufferQueue.appendBuffer";for(var t=e[0].length,i=this.channels,r=this._pendingPos,o=this._pendingBuffer,s=this.bufferSize,n=0;n<t;n++){for(var a=0;a<i;a++)o[a][r]=e[a][n];++r==s&&(this._buffers.push(o),r=this._pendingPos=0,o=this._pendingBuffer=this.createBuffer(s))}this._pendingPos=r},r.prototype.prependBuffer=function(e){if(!this.validate(e))throw"Invalid audio buffer passed to BufferQueue.prependBuffer";var t=this._buffers.slice(0);t.push(this.trimBuffer(this._pendingBuffer,0,this._pendingPos)),this.flush(),this.appendBuffer(e);for(var i=0;i<t.length;i++)this.appendBuffer(t[i])},r.prototype.nextBuffer=function(){if(this._buffers.length)return this._buffers.shift();var e=this.trimBuffer(this._pendingBuffer,0,this._pendingPos);return this._pendingBuffer=this.createBuffer(this.bufferSize),this._pendingPos=0,e},r.prototype.trimBuffer=function(e,t,i){var r=e[0].length,o=t+Math.min(i,r);if(0==t&&o>=r)return e;for(var s=[],n=0;n<this.channels;n++)s[n]=e[n].subarray(t,o);return s},e.exports=r},function(e,t,i){!function(){i(0);var t=i(2),r=i(4);function n(e){this._options=e||{},this._backend=null,this._resampleFractional=0,this._resampleLastSampleData=void 0,this._tempoChanger=null}n.prototype.rate=0,n.prototype.targetRate=0,n.prototype.channels=0,n.prototype.bufferSize=0,Object.defineProperty(n.prototype,"bufferDuration",{get:function(){return this.targetRate?this.bufferSize/this.targetRate:0}}),Object.defineProperty(n.prototype,"bufferThreshold",{get:function(){return this._backend?this._backend.bufferThreshold/this.targetRate:0},set:function(e){if(!this._backend)throw"Invalid state: AudioFeeder cannot set bufferThreshold before init";this._backend.bufferThreshold=Math.round(e*this.targetRate)}}),Object.defineProperty(n.prototype,"playbackPosition",{get:function(){return this._backend?this.getPlaybackState().playbackPosition:0}}),Object.defineProperty(n.prototype,"outputPlaybackPosition",{get:function(){return this._backend?this.getPlaybackState().outputPlaybackPosition:0}}),Object.defineProperty(n.prototype,"durationBuffered",{get:function(){return this._backend?this.getPlaybackState().samplesQueued/this.targetRate:0}}),Object.defineProperty(n.prototype,"muted",{get:function(){if(this._backend)return this._backend.muted;throw"Invalid state: cannot get mute before init"},set:function(e){if(!this._backend)throw"Invalid state: cannot set mute before init";this._backend.muted=e}}),n.prototype.mute=function(){this.muted=!0},n.prototype.unmute=function(){this.muted=!1},Object.defineProperty(n.prototype,"volume",{get:function(){if(this._backend)return this._backend.volume;throw"Invalid state: cannot get volume before init"},set:function(e){if(!this._backend)throw"Invalid state: cannot set volume before init";this._backend.volume=e}}),Object.defineProperty(n.prototype,"tempo",{get:function(){if(this._tempoChanger)return this._tempoChanger.getTempo();throw"Invalid state: cannot get tempo before init"},set:function(e){if(!this._tempoChanger)throw"Invalid state: cannot set tempo before init";this._tempoChanger.setTempo(e)}}),n.prototype.init=function(e,i){if(this.channels=e,this.rate=i,this._options.backendFactory)this._backend=this._options.backendFactory(e,i,this._options);else{if(!t.isSupported())throw"No supported backend";this._backend=new t(e,i,this._options)}this.targetRate=this._backend.rate,this.bufferSize=this._backend.bufferSize,this._tempoChanger=r({sampleRate:this.targetRate,numChannels:e,tempo:1}),this._backend.onstarved=function(){this.onstarved&&this.onstarved()}.bind(this),this._backend.onbufferlow=function(){this.onbufferlow&&this.onbufferlow()}.bind(this)},n.prototype._resample=function(e){var t=this.rate,i=this.channels,r=this._backend.rate,o=this._backend.channels;if(t==r&&i==o)return e;var s,n=[],a=e[0].length,d=this._resampleFractional,u=a*r/t+d,h=Math.floor(u),c=u-h;s=t<r?function(e,i,o,s){for(var a=function(t){return t<0?o&&o.length+t>0?o[o.length+t]:e[0]:e[t]},n=0;n<i.length;n++){var u,h=(n+1-d)*t/r-1,c=Math.floor(h),l=Math.ceil(h);u=c==l?a(c):a(c)*(l-h)+a(l)*(h-c),i[n]=s*u}}:function(e,t,i,r){for(var o=0;o<t.length;o++)t[o]=r*e[o*e.length/t.length|0]};var l=1;o>i&&(l=Math.SQRT1_2);for(var f=0;f<o;f++){var _=f;f>=i&&(_=0);var p=e[_],m=new Float32Array(h);s(p,m,this._resampleLastSampleData?this._resampleLastSampleData[_]:void 0,l),n.push(m)}return this._resampleFractional=c,this._resampleLastSampleData=e,n},n.prototype.bufferData=function(e){if(!this._backend)throw"Invalid state: AudioFeeder cannot bufferData before init";var t=this._resample(e);t=this._tempoChanger.process(t),this._backend.appendBuffer(t)},n.prototype.getPlaybackState=function(){if(this._backend){var e=this._backend.getPlaybackState();return e.outputPlaybackPosition=e.playbackPosition,e.playbackPosition=this._tempoChanger.mapOutputToInputTime(e.outputPlaybackPosition),e}throw"Invalid state: AudioFeeder cannot getPlaybackState before init"},n.prototype.waitUntilReady=function(e){if(!this._backend)throw"Invalid state: AudioFeeder cannot waitUntilReady before init";this._backend.waitUntilReady(e)},n.prototype.start=function(){if(!this._backend)throw"Invalid state: AudioFeeder cannot start before init";this._backend.start()},n.prototype.stop=function(){if(!this._backend)throw"Invalid state: AudioFeeder cannot stop before init";this._backend.stop()},n.prototype.flush=function(){if(this._resampleFractional=0,this._resampleLastSampleData=void 0,!this._backend)throw"Invalid state: AudioFeeder cannot flush before init";this._tempoChanger.flush(this.durationBuffered),this._backend.flush()},n.prototype.close=function(){this._backend&&(this._backend.close(),this._backend=null)},n.prototype.onstarved=null,n.prototype.onbufferlow=null,n.isSupported=function(){return!!Float32Array&&t.isSupported()},n.initSharedAudioContext=function(){return t.isSupported()?t.initSharedAudioContext():null},e.exports=n}()},function(e,t,i){
/**
 * @file Web Audio API backend for AudioFeeder
 * @author Brion Vibber <brion@pobox.com>
 * @copyright (c) 2013-2016 Brion Vibber
 * @license MIT
 */
!function(){var t=window.AudioContext||window.webkitAudioContext,r=i(0),s=i(3);function o(e,t,i){var s=i.audioContext||o.initSharedAudioContext();if(this._context=s,this.output=i.output||s.destination,this.rate=s.sampleRate,this.channels=2,i.bufferSize&&(this.bufferSize=0|i.bufferSize),this.bufferThreshold=2*this.bufferSize,this._bufferQueue=new r(this.channels,this.bufferSize),this._playbackTimeAtBufferTail=s.currentTime,this._queuedTime=0,this._delayedTime=0,this._dropped=0,this._liveBuffer=this._bufferQueue.createBuffer(this.bufferSize),s.createScriptProcessor)this._node=s.createScriptProcessor(this.bufferSize,0,this.channels);else{if(!s.createJavaScriptNode)throw new Error("Bad version of web audio API?");this._node=s.createJavaScriptNode(this.bufferSize,0,this.channels)}}o.prototype.bufferSize=4096,o.prototype.bufferThreshold=8192,o.prototype._volume=1,Object.defineProperty(o.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=+e}}),o.prototype._muted=!1,Object.defineProperty(o.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=!!e}}),o.prototype._audioProcess=function(e){var t,i,r,o,n;n="number"==typeof e.playbackTime?e.playbackTime:this._context.currentTime+this.bufferSize/this.rate;var a=this._playbackTimeAtBufferTail;if(a<n&&(this._delayedTime+=n-a),this._bufferQueue.sampleCount()<this.bufferSize&&this.onstarved&&this.onstarved(),this._bufferQueue.sampleCount()<this.bufferSize){for(t=0;t<this.channels;t++)for(r=e.outputBuffer.getChannelData(t),o=0;o<this.bufferSize;o++)r[o]=0;this._dropped++}else{var d=this.muted?0:this.volume,u=this._bufferQueue.nextBuffer();if(u[0].length<this.bufferSize)throw"Audio buffer not expected length.";for(t=0;t<this.channels;t++)for(i=u[t],this._liveBuffer[t].set(u[t]),r=e.outputBuffer.getChannelData(t),o=0;o<i.length;o++)r[o]=i[o]*d;this._queuedTime+=this.bufferSize/this.rate,this._playbackTimeAtBufferTail=n+this.bufferSize/this.rate,this._bufferQueue.sampleCount()<Math.max(this.bufferSize,this.bufferThreshold)&&this.onbufferlow&&s(this.onbufferlow.bind(this))}},o.prototype._samplesQueued=function(){return this._bufferQueue.sampleCount()+Math.floor(this._timeAwaitingPlayback()*this.rate)},o.prototype._timeAwaitingPlayback=function(){return Math.max(0,this._playbackTimeAtBufferTail-this._context.currentTime)},o.prototype.getPlaybackState=function(){return{playbackPosition:this._queuedTime-this._timeAwaitingPlayback(),samplesQueued:this._samplesQueued(),dropped:this._dropped,delayed:this._delayedTime}},o.prototype.waitUntilReady=function(e){e()},o.prototype.appendBuffer=function(e){this._bufferQueue.appendBuffer(e)},o.prototype.start=function(){this._node.onaudioprocess=this._audioProcess.bind(this),this._node.connect(this.output),this._playbackTimeAtBufferTail=this._context.currentTime},o.prototype.stop=function(){if(this._node){var e=this._timeAwaitingPlayback();if(e>0){var t=Math.round(e*this.rate),i=this._liveBuffer?this._liveBuffer[0].length:0;t>i?(this._bufferQueue.prependBuffer(this._liveBuffer),this._bufferQueue.prependBuffer(this._bufferQueue.createBuffer(t-i))):this._bufferQueue.prependBuffer(this._bufferQueue.trimBuffer(this._liveBuffer,i-t,t)),this._playbackTimeAtBufferTail-=e}this._node.onaudioprocess=null,this._node.disconnect()}},o.prototype.flush=function(){this._bufferQueue.flush()},o.prototype.close=function(){this.stop(),this._context=null},o.prototype.onstarved=null,o.prototype.onbufferlow=null,o.isSupported=function(){return!!t},o.sharedAudioContext=null,o.initSharedAudioContext=function(){if(!o.sharedAudioContext&&o.isSupported()){var e,i=new t;if(i.createScriptProcessor)e=i.createScriptProcessor(1024,0,2);else{if(!i.createJavaScriptNode)throw new Error("Bad version of web audio API?");e=i.createJavaScriptNode(1024,0,2)}e.connect(i.destination),e.disconnect(),o.sharedAudioContext=i}return o.sharedAudioContext},e.exports=o}()},function(e,t){e.exports=function(){if(void 0!==window.setImmediate)return window.setImmediate;if(window&&window.postMessage){var e=[];return window.addEventListener("message",(function(t){if(t.source===window){var i=t.data;if("object"==typeof i&&i.nextTickBrowserPingMessage){var r=e.pop();r&&r()}}})),function(t){e.push(t),window.postMessage({nextTickBrowserPingMessage:!0},document.location.toString())}}return function(e){setTimeout(e,0)}}()},function(e,t,i){var r;window,r=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){var i={float_array:function(e){return new Float32Array(e)},blit:function(e,t,i,r,o){i.set(e.subarray(t,t+o),r)}};e.exports=i},function(e,t,i){var r,o;r=i(0),o=i(2),e.exports=function(e){var t=(e=e||{}).sampleRate||44100,i=e.wsizeLog||11,s=e.tempo||1,n=(e.numChannels,Math.pow(2,50/1200)-1),a=1<<i,d=o(i),u=1<<i-2;u-=u%100;for(var h=r.float_array(a+u+5),c=r.float_array(a+u+5),l=u,f=u,_=r.float_array(a),p=0;p<a;p++)_[p]=.5*(1-Math.cos(2*Math.PI*p/a));var m=1+(a>>1),g=r.float_array(m),y=r.float_array(m),v=r.float_array(m),b=r.float_array(m),T=r.float_array(m),w=r.float_array(m),k=1+(m>>1),E=[0,0],P=[],A=[],x=[],R=[];for(p=0;p<2;p++)P.push(r.float_array(k)),A.push(r.float_array(k)),x.push(r.float_array(k)),R.push(r.float_array(m));var O=r.float_array(k),S=r.float_array(k),F=0,C=0,D=[{in_time:0,out_time:0,tempo:s}],B=0,I=0,M=1,V=0,L=0,j=0,N=0,W={mapOutputToInputTime:function(e){for(var t=D.length-1;e<D[t].out_time&&t>0;)t--;var i=D[t];return i.in_time+i.tempo*(e-i.out_time)},flush:function(e){V=0,E=[0,0],I=0,N=0,j=0;for(var t=0;t<2;t++)for(var i=0;i<m;i++)R[t][i]=0;for(t=0;t<h.length;t++)h[t]=0;for(t=0;t<c.length;t++)c[t]=0;if(e){C=Math.max(0,C-e),F=W.mapOutputToInputTime(C);for(var r=D.length-1;C<=D[r].out_time&&r>=0;)D.pop(),r--;D.push({in_time:F,out_time:C,tempo:s})}},getTempo:function(){return s},setTempo:function(e){l=f=u,e>=1?f=Math.round(l/e):l=Math.round(f*e),L=(1/e-1*f/l)*l,M=function(e,t){for(var i=e.length/t|0,r=0,o=0;o<i;o++)r+=e[o*t];return.9/r}(_,f),s=e;var t=D[D.length-1];t.out_time==C?t.tempo=e:D.push({in_time:F,out_time:C,tempo:e})}};W.flush(0),W.setTempo(s);var J=function(e,t,i){var r=Math.floor(i),o=r%2==1?-1:1;return Math.atan2(o*(t[r]-t[r+1]),o*(e[r]-e[r+1]))},U=function(e,t,i,r,o){var s=2*Math.PI/a*.5*(r+t)*l;return(function(e){return e-2*Math.PI*Math.round(e/(2*Math.PI))}(e-i-s)+s)*o},q=function(e,t,i,r,o,s){for(var d=e%2,u=1-d,h=R[u],c=E[u],l=P[u],f=A[u],_=x[u],p=R[d],m=1;m<p.length;m++)p[m]=t[m]*t[m]+i[m]*i[m];var g=P[d],y=E[d]=function(e,t){for(var i=0,r=0;r<e.length;r++)e[r]>i&&(i=e[r]);var o=1e-8*i,s=1,a=1;for(t[0]=1,r=2;r<e.length;r++){var d=r*n;if(e[r]>o&&e[r]>e[r-1]&&e[r]>=e[r+1]){var u=r+(e[r-1]-e[r+1])/(2*(e[r-1]-2*e[r]+e[r+1]));u-t[s-1]>d?(t[s++]=u,a=r):e[r]>e[a]&&(t[s-1]=u,a=r)}}return s}(p,g),v=A[d],b=x[d];if(0!=e&&0!=y){var T=0;for(G=0;G<y;G++){for(j=g[G];g[G]>l[T]&&T!=c;)++T;var w=T;T>0&&j-l[T-1]<l[T]-j&&(w=T-1);var k=j*n;if(Math.abs(l[w]-j)<k&&h[Math.round(l[w])]>.1*p[Math.round(j)]){var F=J(t,i,j),C=f[w]+_[w]+U(F,j,f[w],l[w],s)-F;v[G]=F,b[G]=C,O[G]=Math.cos(C),S[G]=Math.sin(C)}else v[G]=J(t,i,j),b[G]=0,O[G]=1,S[G]=0}g[y]=2*a;var D=g[w=0],B=g[w+1],I=O[w],M=S[w];for(m=1;m<t.length-1;m++){m>=D&&m-D>B-m&&(D=g[++w],B=g[w+1],I=O[w],M=S[w]);var V=t[m]*I-i[m]*M,L=t[m]*M+i[m]*I;t[m]=V,i[m]=L}}else for(var G=0;G<y;G++){var j=g[G];f[G]=_[G]=J(t,i,j)}},G=function(){var e=0|(V+=2*L);V-=e;for(var t=0;t<a;t++)d.m_re[t]=_[t]*h[t],d.m_im[t]=_[t]*h[l+t];r.blit(h,2*l,h,0,a-l),d.inplace(!1),d.unpack(g,y,v,b),q(B,g,y,0,0,1*f/l),q(B+1,v,b,0,0,1*(f+e)/l),r.blit(v,0,T,0,m),r.blit(b,0,w,0,m),d.repack(g,y,v,b),d.inplace(!0);var i=c.length;for(r.blit(c,I,c,0,i-I),t=i-I;t<i;t++)c[t]=0;var o=0,s=M;for(t=0;t<f;t++)Math.abs(2*d.m_re[t])>o&&(o=Math.abs(2*d.m_re[t]));for(t=0;t<a-f;t++)Math.abs(d.m_re[t+f+e]+d.m_im[t])>o&&(o=Math.abs(d.m_re[t+f+e]+d.m_im[t]));for(t=a-f;t<a;t++)Math.abs(2*d.m_im[t])>o&&(o=Math.abs(2*d.m_im[t]));var n=1/Math.floor(1*a/(2*f));for(s*o>n&&(s=n/o),t=0;t<a;t++)c[t]+=s*d.m_re[t],c[t+f+e]+=s*d.m_im[t];return B+=2,I=2*f+e};return W.process=function(e){var i=e[0].length,o=e[0];if(e.length>1){o=r.float_array(e[0].length);for(var n=1/e.length,d=0;d<e.length;d++)for(var u=0;u<i;u++)o[u]+=n*e[d][u]}if(1==s){if(N+j>0){var _=N+j+i,p=[];for(d=0;d<e.length;d++){var m=r.float_array(_);r.blit(c,0,m,0,N),r.blit(h,0,m,N,j),r.blit(e[d],0,m,N+j,i),p.push(m)}W.flush(0),i=_,e=p}return F+=i/t,C+=i/t,e}var g=j+i-(a-l),y=2*Math.floor(Math.max(0,g)/(2*l)),v=N+f*y+Math.floor(V+L*y);N>v&&(v=N);var b=r.float_array(v);r.blit(c,0,b,0,N);for(var T=0,w=N,k=0,E=0;;){var P=a+l-j;if(T+P>i){r.blit(o,T,h,j,i-T),j+=i-T,T=i;break}P<=0?j-=2*l:(r.blit(o,T,h,j,P),T+=P,j=a-l),E=G(),F+=2*l/t,C+=E/t,(k=w+E-v)<0&&(k=0),r.blit(c,0,b,w,E-k),w+=E}r.blit(c,E-k,c,0,k),N=k;var A=[];for(d=0;d<e.length;d++)A.push(b);return A},W}},function(e,t,i){"use strict";var r=i(0);e.exports=function(e){for(var t=1<<e,i={m_logN:e,m_N:t,m_invN:1/t,m_re:r.float_array(t),m_im:r.float_array(t),m_revTgt:new Array(t)},o=0;o<t;o++){for(var s=o,n=0,a=0;a<e;a++)n<<=1,n|=1&s,s>>=1;i.m_revTgt[o]=n}i.twiddleRe=r.float_array(i.m_logN),i.twiddleIm=r.float_array(i.m_logN);for(var d=1,u=0;u<i.m_logN;u++){var h=2*d*Math.PI*i.m_invN;i.twiddleRe[u]=Math.cos(h),i.twiddleIm[u]=Math.sin(h),d<<=1}i.inplace=function(e){var t=i.m_re,r=i.m_im,o=i.m_N,s=i.m_logN,n=o>>1,a=o>>1,d=o;if(e)for(var u=1/o,h=0;h<o;h++)t[h]*=u,r[h]*=u;for(var c=0;c<s;c++){var l=i.twiddleRe[c],f=i.twiddleIm[c];e||(f*=-1);for(var _=0;_<o;){for(var p=_,m=_+a,g=1,y=0,v=0;v<n;v++){var b=t[p],T=r[p],w=t[m],k=r[m];t[p]=b+w,r[p]=T+k,w=b-w,k=T-k,t[m]=w*g-k*y,r[m]=w*y+k*g,p++,m++;var E=g;g=g*l-y*f,y=E*f+y*l}_+=d}n>>=1,a>>=1,d>>=1}for(var P,A,x=i.m_revTgt,R=0;R<o;R++)x[R]>R&&(A=t[P=x[R]],t[P]=t[R],t[R]=A,A=r[P],r[P]=r[R],r[R]=A)};var c=t>>1;return i.unpack=function(e,r,o,s){e[0]=i.m_re[0],o[0]=i.m_im[0],r[0]=s[0]=0,e[c]=i.m_re[c],o[c]=i.m_im[c],r[c]=s[c]=0;for(var n=1;n<c;n++)e[n]=(i.m_re[n]+i.m_re[t-n])/2,r[n]=(i.m_im[n]-i.m_im[t-n])/2,o[n]=(i.m_im[n]+i.m_im[t-n])/2,s[n]=(-i.m_re[n]+i.m_re[t-n])/2},i.repack=function(e,r,o,s){i.m_re[0]=e[0],i.m_im[0]=o[0],i.m_re[c]=e[c],i.m_im[c]=o[c];for(var n=1;n<c;n++)i.m_re[n]=e[n]-s[n],i.m_im[n]=r[n]+o[n],i.m_re[t-n]=e[n]+s[n],i.m_im[t-n]=-r[n]+o[n]},i}}])},e.exports=r()}])},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=class Bisector{constructor(e){this.lower=e.start,this.upper=e.end,this.onprocess=e.process,this.position=0,this.n=0}iterate(){return this.n++,this.position=Math.floor((this.lower+this.upper)/2),this.onprocess(this.lower,this.upper,this.position)}start(){return this.iterate(),this}left(){return this.upper=this.position,this.iterate()}right(){return this.lower=this.position,this.iterate()}};t.default=r},function(e,t,i){"use strict";var r=i(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i(1));
/**
 * Proxy object for web worker interface for codec classes.
 *
 * Used by the high-level player interface.
 *
 * @author Brion Vibber <brion@pobox.com>
 * @copyright 2015-2019 Brion Vibber
 * @license MIT-style
 */var s=class OGVWrapperCodec{constructor(e){return this.options=e||{},this.demuxer=null,this.videoDecoder=null,this.audioDecoder=null,this.flushIter=0,this.loadedMetadata=!1,this.processing=!1,Object.defineProperties(this,{duration:{get:function get(){return this.loadedMetadata?this.demuxer.duration:NaN}},hasAudio:{get:function get(){return this.loadedMetadata&&!!this.audioDecoder}},audioReady:{get:function get(){return this.hasAudio&&this.demuxer.audioReady}},audioTimestamp:{get:function get(){return this.demuxer.audioTimestamp}},audioFormat:{get:function get(){return this.hasAudio?this.audioDecoder.audioFormat:null}},audioBuffer:{get:function get(){return this.hasAudio?this.audioDecoder.audioBuffer:null}},hasVideo:{get:function get(){return this.loadedMetadata&&!!this.videoDecoder}},frameReady:{get:function get(){return this.hasVideo&&this.demuxer.frameReady}},frameTimestamp:{get:function get(){return this.demuxer.frameTimestamp}},keyframeTimestamp:{get:function get(){return this.demuxer.keyframeTimestamp}},nextKeyframeTimestamp:{get:function get(){return this.demuxer.nextKeyframeTimestamp}},videoFormat:{get:function get(){return this.hasVideo?this.videoDecoder.videoFormat:null}},frameBuffer:{get:function get(){return this.hasVideo?this.videoDecoder.frameBuffer:null}},seekable:{get:function get(){return this.demuxer.seekable}},demuxerCpuTime:{get:function get(){return this.demuxer?this.demuxer.cpuTime:0}},audioCpuTime:{get:function get(){return this.audioDecoder?this.audioDecoder.cpuTime:0}},videoCpuTime:{get:function get(){return this.videoDecoder?this.videoDecoder.cpuTime:0}}}),this.loadedDemuxerMetadata=!1,this.loadedAudioMetadata=!1,this.loadedVideoMetadata=!1,this.loadedAllMetadata=!1,this.onseek=null,this.videoBytes=0,this.audioBytes=0,this}flushSafe(e){let t=this.flushIter;return i=>{this.flushIter<=t&&e(i)}}init(e){let t;this.processing=!0,t="video/webm"===this.options.type||"audio/webm"===this.options.type?"OGVDemuxerWebMW":"OGVDemuxerOggW",o.default.loadClass(t,t=>{t().then(t=>{this.demuxer=t,t.onseek=e=>{this.onseek&&this.onseek(e)},t.init(()=>{this.processing=!1,e()})})})}close(){this.demuxer&&(this.demuxer.close(),this.demuxer=null),this.videoDecoder&&(this.videoDecoder.close(),this.videoDecoder=null),this.audioDecoder&&(this.audioDecoder.close(),this.audioDecoder=null)}receiveInput(e,t){this.demuxer.receiveInput(e,t)}process(e){if(this.processing)throw new Error("reentrancy fail on OGVWrapperCodec.process");this.processing=!0;let finish=t=>{this.processing=!1,e(t)},doProcessData=()=>{this.demuxer.process(finish)};this.demuxer.loadedMetadata&&!this.loadedDemuxerMetadata?this.loadAudioCodec(()=>{this.loadVideoCodec(()=>{this.loadedDemuxerMetadata=!0,this.loadedAudioMetadata=!this.audioDecoder,this.loadedVideoMetadata=!this.videoDecoder,this.loadedAllMetadata=this.loadedAudioMetadata&&this.loadedVideoMetadata,finish(!0)})}):this.loadedDemuxerMetadata&&!this.loadedAudioMetadata?this.audioDecoder.loadedMetadata?(this.loadedAudioMetadata=!0,this.loadedAllMetadata=this.loadedAudioMetadata&&this.loadedVideoMetadata,finish(!0)):this.demuxer.audioReady?this.demuxer.dequeueAudioPacket((e,t)=>{this.audioBytes+=e.byteLength,this.audioDecoder.processHeader(e,e=>{finish(!0)})}):doProcessData():this.loadedAudioMetadata&&!this.loadedVideoMetadata?this.videoDecoder.loadedMetadata?(this.loadedVideoMetadata=!0,this.loadedAllMetadata=this.loadedAudioMetadata&&this.loadedVideoMetadata,finish(!0)):this.demuxer.frameReady?(this.processing=!0,this.demuxer.dequeueVideoPacket(e=>{this.videoBytes+=e.byteLength,this.videoDecoder.processHeader(e,()=>{finish(!0)})})):doProcessData():this.loadedVideoMetadata&&!this.loadedMetadata&&this.loadedAllMetadata?(this.loadedMetadata=!0,finish(!0)):!this.loadedMetadata||this.hasAudio&&!this.demuxer.audioReady||this.hasVideo&&!this.demuxer.frameReady?doProcessData():finish(!0)}decodeFrame(e){let t=this.flushSafe(e),i=this.frameTimestamp,r=this.keyframeTimestamp;this.demuxer.dequeueVideoPacket(e=>{this.videoBytes+=e.byteLength,this.videoDecoder.processFrame(e,e=>{let o=this.videoDecoder.frameBuffer;o&&(o.timestamp=i,o.keyframeTimestamp=r),t(e)})})}decodeAudio(e){let t=this.flushSafe(e);this.demuxer.dequeueAudioPacket((e,i)=>{this.audioBytes+=e.byteLength,this.audioDecoder.processAudio(e,e=>{if(i){let e=this.audioDecoder.audioBuffer,t=[];for(let r of e){let e=Math.round(i*this.audioFormat.rate/1e9);e>0?t.push(r.subarray(0,r.length-Math.min(e,r.length))):t.push(r.subarray(Math.min(Math.abs(e),r.length),r.length))}this.audioDecoder.audioBuffer=t}return t(e)})})}discardFrame(e){this.demuxer.dequeueVideoPacket(t=>{this.videoBytes+=t.byteLength,e()})}discardAudio(e){this.demuxer.dequeueAudioPacket((t,i)=>{this.audioBytes+=t.byteLength,e()})}flush(e){this.flushIter++,this.demuxer.flush(e)}sync(){this.videoDecoder&&this.videoDecoder.sync()}recycleFrame(e){this.videoDecoder&&this.videoDecoder.recycleFrame(e)}getKeypointOffset(e,t){this.demuxer.getKeypointOffset(e,t)}seekToKeypoint(e,t){this.demuxer.seekToKeypoint(e,this.flushSafe(t))}loadAudioCodec(e){if(this.demuxer.audioCodec){let t={vorbis:"OGVDecoderAudioVorbisW",opus:"OGVDecoderAudioOpusW"}[this.demuxer.audioCodec];this.processing=!0,o.default.loadClass(t,t=>{let i={};this.demuxer.audioFormat&&(i.audioFormat=this.demuxer.audioFormat),t(i).then(t=>{this.audioDecoder=t,t.init(()=>{this.loadedAudioMetadata=t.loadedMetadata,this.processing=!1,e()})})},{worker:this.options.worker})}else e()}loadVideoCodec(e){if(this.demuxer.videoCodec){let t=!!this.options.simd,i=!!this.options.threading,r={theora:"OGVDecoderVideoTheoraW",vp8:i?"OGVDecoderVideoVP8MTW":"OGVDecoderVideoVP8W",vp9:i?t?"OGVDecoderVideoVP9SIMDMTW":"OGVDecoderVideoVP9MTW":t?"OGVDecoderVideoVP9SIMDW":"OGVDecoderVideoVP9W",av1:i?t?"OGVDecoderVideoAV1SIMDMTW":"OGVDecoderVideoAV1MTW":t?"OGVDecoderVideoAV1SIMDW":"OGVDecoderVideoAV1W"}[this.demuxer.videoCodec];this.processing=!0,o.default.loadClass(r,t=>{let r={};this.demuxer.videoFormat&&(r.videoFormat=this.demuxer.videoFormat),i&&delete window.ENVIRONMENT_IS_PTHREAD,t(r).then(t=>{this.videoDecoder=t,t.init(()=>{this.loadedVideoMetadata=t.loadedMetadata,this.processing=!1,e()})})},{worker:this.options.worker&&!this.options.threading})}else e()}};t.default=s}])}));